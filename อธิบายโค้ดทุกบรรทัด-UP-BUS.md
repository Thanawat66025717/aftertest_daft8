# üìñ ‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡πÇ‡∏Ñ‡πâ‡∏î‡∏ó‡∏∏‡∏Å‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î ‚Äî ‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå UP BUS
### ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏™‡∏≠‡∏ö ‚Äî ‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡πÅ‡∏°‡πâ‡πÑ‡∏°‡πà‡∏£‡∏π‡πâ Dart / Flutter ‡∏°‡∏≤‡∏Å‡πà‡∏≠‡∏ô

---

# üìÅ ‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà 1: `main.dart` (68 ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î) ‚Äî ‡∏à‡∏∏‡∏î‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏Ç‡∏≠‡∏á‡πÅ‡∏≠‡∏õ

```
‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 1‚Äì10: import (‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤ library ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ)
```
- `flutter/material.dart` ‚Üí ‡∏ä‡∏∏‡∏î‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠ UI ‡∏Ç‡∏≠‡∏á Flutter (‡∏õ‡∏∏‡πà‡∏°, ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°, ‡∏™‡∏µ ‡∏Ø‡∏•‡∏Ø)
- `firebase_core/firebase_core.dart` ‚Üí ‡πÉ‡∏ä‡πâ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô Firebase
- `provider/provider.dart` ‚Üí ‡∏ï‡∏±‡∏ß‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ State (‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•) ‡πÅ‡∏ä‡∏£‡πå‡∏Ç‡πâ‡∏≤‡∏°‡∏´‡∏ô‡πâ‡∏≤
- `firebase_options.dart` ‚Üí ‡∏Ñ‡πà‡∏≤ config Firebase (Auto-generated)
- Import ‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡πÜ ‡∏Ç‡∏≠‡∏á‡πÅ‡∏≠‡∏õ: `busstop-page`, `feedback-page`, `route-page`, `upbus-page`, `plan-page`, `busstop_map_page`, `login_page`
- Import `global_location_service.dart` ‚Üí Service ‡∏´‡∏•‡∏±‡∏Å‡∏ó‡∏µ‡πà‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏° GPS

```
‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 22: void main() async {
```
- **‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô `main()`** = ‡∏à‡∏∏‡∏î‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ó‡∏µ‡πà Dart ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÄ‡∏õ‡πá‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÅ‡∏£‡∏Å
- `async` = ‡∏ö‡∏≠‡∏Å‡∏ß‡πà‡∏≤‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏á‡∏≤‡∏ô "‡∏£‡∏≠" (‡πÄ‡∏ä‡πà‡∏ô ‡∏£‡∏≠ Firebase ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à)

```
‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 23: WidgetsFlutterBinding.ensureInitialized();
```
- ‡∏ö‡∏≠‡∏Å Flutter ‡∏ß‡πà‡∏≤ "‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏£‡∏∞‡∏ö‡∏ö Widget ‡πÉ‡∏´‡πâ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡πà‡∏≠‡∏ô‡∏ô‡∏∞" ‚Äî ‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ `await` ‡∏Å‡πà‡∏≠‡∏ô `runApp()`

```
‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 24: await Firebase.initializeApp(options: DefaultFirebaseOptions.currentPlatform);
```
- ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô Firebase ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ‡∏Ñ‡πà‡∏≤ config ‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡πÅ‡∏û‡∏•‡∏ï‡∏ü‡∏≠‡∏£‡πå‡∏° (Android/iOS)
- `await` = ‡∏£‡∏≠‡∏à‡∏ô Firebase ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡πà‡∏≠‡∏ô‡∏ó‡∏≥‡∏ï‡πà‡∏≠

```
‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 27: final globalLocationService = GlobalLocationService();
```
- ‡∏™‡∏£‡πâ‡∏≤‡∏á instance ‡∏Ç‡∏≠‡∏á `GlobalLocationService` (‡∏ï‡∏±‡∏ß‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ GPS + ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô)
- ‡πÑ‡∏°‡πà `await initialize()` ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏à‡∏≠‡∏Ç‡∏≤‡∏ß‡∏Ñ‡πâ‡∏≤‡∏á‡∏ï‡∏≠‡∏ô‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏≠‡∏õ

```
‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 31‚Äì36: runApp(ChangeNotifierProvider.value(...))
```
- `ChangeNotifierProvider.value()` = ‡∏´‡πà‡∏≠‡πÅ‡∏≠‡∏õ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏î‡πâ‡∏ß‡∏¢ Provider
- ‡∏ó‡∏≥‡πÉ‡∏´‡πâ **‡∏ó‡∏∏‡∏Å‡∏´‡∏ô‡πâ‡∏≤** ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á `globalLocationService` ‡πÑ‡∏î‡πâ
- `runApp(MyApp())` = ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÅ‡∏≠‡∏õ Flutter ‡∏à‡∏£‡∏¥‡∏á‡πÜ

```
‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 39‚Äì67: class MyApp extends StatelessWidget
```
- ‡∏Ñ‡∏•‡∏≤‡∏™‡πÅ‡∏≠‡∏õ‡∏´‡∏•‡∏±‡∏Å (‡πÑ‡∏°‡πà‡∏°‡∏µ State ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á ‚Üí `StatelessWidget`)
- ‡∏Å‡∏≥‡∏´‡∏ô‡∏î `MaterialApp` ‡∏Ç‡πâ‡∏≤‡∏á‡πÉ‡∏ô:
  - `debugShowCheckedModeBanner: false` ‚Üí ‡∏õ‡∏¥‡∏î‡πÅ‡∏ñ‡∏ö "DEBUG" ‡∏°‡∏∏‡∏°‡∏Ç‡∏ß‡∏≤‡∏ö‡∏ô
  - `title: 'UP BUS'` ‚Üí ‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏≠‡∏õ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö
  - `theme` ‚Üí ‡∏ò‡∏µ‡∏°‡∏™‡∏µ‡∏°‡πà‡∏ß‡∏á (`primaryColor: 0xFF9C27B0`)
  - `initialRoute: '/'` ‚Üí ‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏Ñ‡∏∑‡∏≠ `/` (UpBusHomePage)

```
‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 52‚Äì63: routes: { ... }
```
- ‡∏Å‡∏≥‡∏´‡∏ô‡∏î **Named Routes** = ‡∏Å‡∏é‡∏ß‡πà‡∏≤ URL ‡πÑ‡∏´‡∏ô‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡πÑ‡∏´‡∏ô:

| Route | ‡∏´‡∏ô‡πâ‡∏≤ |
|-------|------|
| `/` | `UpBusHomePage` (‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà Live) |
| `/busStop` | `BusStopPage` (‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏õ‡πâ‡∏≤‡∏¢) |
| `/route` | `RoutePage` (‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á) |
| `/plan` | `PlanPage` (‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô) |
| `/feedback` | `FeedbackPage` |
| `/login` | `LoginPage` |
| `/busStopMap` | `BusStopMapPage` |

---

# üìÅ ‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà 2: `notification_service.dart` (118 ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î) ‚Äî ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Notification + ‡∏™‡∏±‡πà‡∏ô

```
‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 1‚Äì2: import
```
- `flutter_local_notifications` ‚Üí library ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏î‡∏á Push Notification
- `vibration` ‚Üí library ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏±‡πà‡∏ô‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô

```
‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 5: class NotificationService
```
- ‡πÄ‡∏õ‡πá‡∏ô **Static class** (‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á instance, ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢ ‡πÄ‡∏ä‡πà‡∏ô `NotificationService.initialize()`)

```
‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 6‚Äì7: static final FlutterLocalNotificationsPlugin _notifications = ...
```
- ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏±‡∏ß Plugin ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏î‡∏á Notification (‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß ‡πÉ‡∏ä‡πâ‡∏ã‡πâ‡∏≥)

```
‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 9: static bool _initialized = false;
```
- ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤ "initialize ‡πÅ‡∏•‡πâ‡∏ß‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á?" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏ó‡∏≥‡∏ã‡πâ‡∏≥

```
‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 12‚Äì31: static Future<void> initialize()
```
- ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Notification ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Android (‡πÉ‡∏ä‡πâ‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡πÅ‡∏≠‡∏õ `@mipmap/ic_launcher`)
- ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Notification ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö iOS (‡∏Ç‡∏≠ permission ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô, badge, ‡πÄ‡∏™‡∏µ‡∏¢‡∏á)
- ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å `_notifications.initialize()` ‚Üí ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏£‡∏∞‡∏ö‡∏ö‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
- `_initialized = true` ‚Üí ‡∏à‡∏≥‡πÑ‡∏ß‡πâ‡∏ß‡πà‡∏≤‡∏ó‡∏≥‡πÅ‡∏•‡πâ‡∏ß

```
‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 35‚Äì41: static int calculateEtaSeconds(...)  ‚≠ê ‡∏™‡∏π‡∏ï‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì ETA
```
- **‡∏™‡∏π‡∏ï‡∏£‡∏ü‡∏¥‡∏™‡∏¥‡∏Å‡∏™‡πå:** ‡πÄ‡∏ß‡∏•‡∏≤ = ‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á √∑ ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß
- ‡∏£‡∏±‡∏ö `distanceMeters` (‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏°‡∏ï‡∏£) ‡πÅ‡∏•‡∏∞ `speedKmh` (‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß ‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô 35 ‡∏Å‡∏°./‡∏ä‡∏°.)
- **‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 39:** ‡πÅ‡∏õ‡∏•‡∏á km/h ‚Üí m/s: `35 √ó 1000 √∑ 3600 = 9.72 m/s`
- **‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 40:** ‡∏´‡∏≤‡∏£ `distanceMeters / speedMs` ‡πÅ‡∏•‡πâ‡∏ß `.round()` ‡∏õ‡∏±‡∏î‡πÄ‡∏®‡∏© ‚Üí ‡πÑ‡∏î‡πâ ETA ‡πÄ‡∏õ‡πá‡∏ô‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ

```
‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 44‚Äì54: static String formatEta(int etaSeconds)
```
- ‡πÅ‡∏õ‡∏•‡∏á‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏≠‡πà‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢:
  - ‚â§ 0 ‚Üí `"‡∏ñ‡∏∂‡∏á‡πÅ‡∏•‡πâ‡∏ß"`
  - < 60 ‚Üí `"XX ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ"`
  - ‚â• 60 ‚Üí `"X ‡∏ô‡∏≤‡∏ó‡∏µ Y ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ"` ‡∏´‡∏£‡∏∑‡∏≠ `"X ‡∏ô‡∏≤‡∏ó‡∏µ"` (‡∏ñ‡πâ‡∏≤ Y = 0)
- ‡πÉ‡∏ä‡πâ `~/` = ‡∏´‡∏≤‡∏£‡∏õ‡∏±‡∏î‡∏•‡∏á (integer division), `%` = ‡πÄ‡∏≠‡∏≤‡πÄ‡∏®‡∏©

```
‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 57‚Äì92: static Future<void> showBusNearbyNotification(...)
```
- ‡πÅ‡∏™‡∏î‡∏á Push Notification ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
- ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Android: channel `'bus_proximity_channel'`, importance ‡∏™‡∏π‡∏á, ‡∏°‡∏µ‡πÄ‡∏™‡∏µ‡∏¢‡∏á+‡∏™‡∏±‡πà‡∏ô
- ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ iOS: ‡πÅ‡∏™‡∏î‡∏á alert, badge, ‡πÄ‡∏™‡∏µ‡∏¢‡∏á
- **‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 86:** ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°: `"‡∏£‡∏ñ‡πÄ‡∏ö‡∏≠‡∏£‡πå X ‡∏≠‡∏¢‡∏π‡πà‡∏´‡πà‡∏≤‡∏á 500 ‡πÄ‡∏°‡∏ï‡∏£ (51 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ)"`
- **‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 91:** ‡πÅ‡∏™‡∏î‡∏á Notification ‡∏î‡πâ‡∏ß‡∏¢ emoji üöå

```
‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 95‚Äì100: static Future<void> vibrate()
```
- ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á **‡∏°‡∏µ motor ‡∏™‡∏±‡πà‡∏ô** ‡πÑ‡∏´‡∏° ‚Üí ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ ‡∏™‡∏±‡πà‡∏ô 1 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏£‡∏á 128

```
‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 103‚Äì116: static Future<void> alertBusNearby(...)
```
- **‡∏£‡∏ß‡∏° notification + vibrate** ‡πÄ‡∏Ç‡πâ‡∏≤‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏±‡∏ô
- ‡πÉ‡∏ä‡πâ `Future.wait([...])` ‚Üí ‡∏ó‡∏≥ 2 ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ô (‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏≠‡∏ó‡∏µ‡∏•‡∏∞‡∏≠‡∏±‡∏ô)

---

# üìÅ ‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà 3: `route_service.dart` (71 ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î) ‚Äî ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å API + Cache

```
‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 1‚Äì3: import
```
- `dart:convert` ‚Üí ‡πÅ‡∏õ‡∏•‡∏á JSON ‡πÄ‡∏õ‡πá‡∏ô Map/List
- `http` ‚Üí ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å API ‡∏ú‡πà‡∏≤‡∏ô HTTP
- `latlong2` ‚Üí ‡∏Ñ‡∏•‡∏≤‡∏™‡∏û‡∏¥‡∏Å‡∏±‡∏î LatLng

```
‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 6‚Äì10: class RouteService
```
- Static class ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á **‡∏ï‡∏≤‡∏°‡∏ñ‡∏ô‡∏ô‡∏à‡∏£‡∏¥‡∏á** ‡∏ú‡πà‡∏≤‡∏ô OpenRouteService API
- `_apiKey` = API Key (encoded Base64)
- `_baseUrl` = URL ‡∏Ç‡∏≠‡∏á API

```
‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 13: static final Map<String, _CachedDistance> _cache = {};
```
- **Cache** = ‡∏ï‡∏±‡∏ß‡∏à‡∏≥‡∏Ñ‡πà‡∏≤‡πÄ‡∏Å‡πà‡∏≤ (Map ‡∏ó‡∏µ‡πà key = "‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏ï‡πâ‡∏ô‡∏ó‡∏≤‡∏á-‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á", value = ‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á+‡πÄ‡∏ß‡∏•‡∏≤)

```
‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 14: static const Duration _cacheExpiry = Duration(seconds: 30);
```
- Cache **‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏‡πÉ‡∏ô 30 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ** ‚Üí ‡∏ñ‡πâ‡∏≤‡∏ñ‡∏≤‡∏°‡∏ã‡πâ‡∏≥‡∏†‡∏≤‡∏¢‡πÉ‡∏ô 30 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ ‡πÉ‡∏ä‡πâ‡∏Ñ‡πà‡∏≤‡πÄ‡∏Å‡πà‡∏≤

```
‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 18‚Äì57: static Future<double?> getRoadDistance(from, to)
```
**Flow ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô:**

1. ‡∏™‡∏£‡πâ‡∏≤‡∏á cache key ‡∏à‡∏≤‡∏Å‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏ï‡πâ‡∏ô‡∏ó‡∏≤‡∏á-‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á (‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 19‚Äì20)
2. **‡πÄ‡∏ä‡πá‡∏Ñ cache** (‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 23‚Äì28):
   - ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏Ñ‡πà‡∏≤‡πÄ‡∏Å‡πà‡∏≤ **‡πÅ‡∏•‡∏∞** ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 30 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ ‚Üí return ‡∏Ñ‡πà‡∏≤‡πÄ‡∏Å‡πà‡∏≤‡πÄ‡∏•‡∏¢
3. **‡πÄ‡∏£‡∏µ‡∏¢‡∏Å API** (‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 30‚Äì56):
   - ‡∏™‡∏£‡πâ‡∏≤‡∏á URL: `$_baseUrl?start=lon,lat&end=lon,lat`
   - ‡∏™‡πà‡∏á HTTP GET ‡∏û‡∏£‡πâ‡∏≠‡∏° header Authorization
   - ‡∏ï‡∏±‡πâ‡∏á timeout 5 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ (‡∏ñ‡πâ‡∏≤ API ‡πÑ‡∏°‡πà‡∏ï‡∏≠‡∏ö‡∏†‡∏≤‡∏¢‡πÉ‡∏ô 5 ‡∏ß‡∏¥ ‚Üí error)
   - ‡∏ñ‡πâ‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (status 200): ‡πÅ‡∏Å‡∏∞ JSON ‡πÄ‡∏≠‡∏≤‡∏Ñ‡πà‡∏≤ distance ‚Üí **‡πÄ‡∏Å‡πá‡∏ö cache** ‚Üí return
   - ‡∏ñ‡πâ‡∏≤‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß: print error ‚Üí return `null`

```
‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 60‚Äì62: static void clearCache()
```
- ‡∏•‡πâ‡∏≤‡∏á cache ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î

```
‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 65‚Äì70: class _CachedDistance
```
- Model ‡πÄ‡∏Å‡πá‡∏ö distance + timestamp (‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà cache ‡πÑ‡∏ß‡πâ) ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á

---

# üìÅ ‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà 4: `global_location_service.dart` (431 ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î) ‚Äî ‡∏´‡∏±‡∏ß‡πÉ‡∏à‡∏Ç‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏ö GPS + ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô ‚≠ê

```
‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 1‚Äì9: import
```
- `dart:async` ‚Üí ‡πÉ‡∏ä‡πâ StreamSubscription (‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á)
- `geolocator` ‚Üí ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏° GPS ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
- `latlong2` ‚Üí ‡∏Ñ‡∏•‡∏≤‡∏™‡∏û‡∏¥‡∏Å‡∏±‡∏î
- `firebase_database` ‚Üí Realtime Database (‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏£‡∏ñ)
- `cloud_firestore` ‚Üí Firestore (‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡πâ‡∏≤‡∏¢‡∏£‡∏ñ)
- Import models ‡πÅ‡∏•‡∏∞ services ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ

```
‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 13‚Äì17: class GlobalLocationService extends ChangeNotifier ‚Äî Singleton Pattern
```
- `extends ChangeNotifier` ‚Üí ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ "‡πÅ‡∏à‡πâ‡∏á" UI ‡πÉ‡∏´‡πâ rebuild ‡πÑ‡∏î‡πâ
- **Singleton Pattern:**
  - `_instance` = instance ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß ‡πÉ‡∏ä‡πâ‡∏ã‡πâ‡∏≥‡∏ó‡∏±‡πâ‡∏á‡πÅ‡∏≠‡∏õ
  - `factory` constructor ‚Üí ‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏µ‡πà‡∏Ñ‡∏£‡∏±‡πâ‡∏á ‡∏Å‡πá‡πÑ‡∏î‡πâ‡∏ï‡∏±‡∏ß‡πÄ‡∏î‡∏¥‡∏°
  - `_internal()` = constructor ‡∏à‡∏£‡∏¥‡∏á‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÅ‡∏Ñ‡πà‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß

```
‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 19‚Äì42: ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ State ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
```
| ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ | ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢ |
|--------|----------|
| `_userPosition` | ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á GPS ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ |
| `_buses` | ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏£‡∏ñ‡∏ö‡∏±‡∏™‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ó‡∏µ‡πà online |
| `_closestBus` | ‡∏£‡∏ñ‡∏ó‡∏µ‡πà‡πÉ‡∏Å‡∏•‡πâ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î |
| `_allBusStops` | ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏õ‡πâ‡∏≤‡∏¢‡∏£‡∏ñ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏à‡∏≤‡∏Å Firestore |
| `_notifyEnabled` | ‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà |
| `_selectedNotifyRouteId` | ‡∏™‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô (null = ‡∏ó‡∏∏‡∏Å‡∏™‡∏≤‡∏¢) |
| `_destinationName` | ‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏∏‡∏î‡∏´‡∏°‡∏≤‡∏¢‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á |
| `_prevDistToDest` | Map ‡πÄ‡∏Å‡πá‡∏ö "‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á‡∏à‡∏≤‡∏Å‡∏£‡∏ñ‡∏ñ‡∏∂‡∏á‡∏à‡∏∏‡∏î‡∏´‡∏°‡∏≤‡∏¢" ‡∏£‡∏≠‡∏ö‡∏Å‡πà‡∏≠‡∏ô (‡πÉ‡∏ä‡πâ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ó‡∏¥‡∏®‡∏ó‡∏≤‡∏á) |
| `_lastAlertStage` | Map ‡πÄ‡∏Å‡πá‡∏ö "‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ñ‡∏∂‡∏á‡∏Ç‡∏±‡πâ‡∏ô‡πÑ‡∏´‡∏ô‡πÅ‡∏•‡πâ‡∏ß" (0=‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÅ‡∏à‡πâ‡∏á, 4=‡∏ñ‡∏∂‡∏á‡πÅ‡∏•‡πâ‡∏ß) |
| `_alertDistanceMeters` | 250 ‡πÄ‡∏°‡∏ï‡∏£ = ‡∏£‡∏∞‡∏¢‡∏∞ "‡∏°‡∏≤‡∏ñ‡∏∂‡∏á‡πÅ‡∏•‡πâ‡∏ß" |

```
‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 56‚Äì68: Future<void> initialize()
```
1. ‡∏ñ‡πâ‡∏≤ `_isInitialized` ‡πÅ‡∏•‡πâ‡∏ß ‚Üí return (‡πÑ‡∏°‡πà‡∏ó‡∏≥‡∏ã‡πâ‡∏≥)
2. ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å `NotificationService.initialize()` ‚Üí ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
3. ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å `_fetchBusStops()` ‚Üí ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡πâ‡∏≤‡∏¢‡∏à‡∏≤‡∏Å Firestore
4. ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å `_listenToBusLocation()` ‚Üí ‡πÄ‡∏õ‡∏¥‡∏î listener ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏£‡∏ñ‡∏à‡∏≤‡∏Å RTDB
5. ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å `_startLocationTracking()` ‚Üí ‡πÄ‡∏õ‡∏¥‡∏î GPS ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ

```
‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 71‚Äì79: void setNotifyEnabled(bool, routeId)
```
- ‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô + ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏≤‡∏¢
- `_lastAlertStage.clear()` ‚Üí reset ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô (‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà)
- `notifyListeners()` ‚Üí ‡∏ö‡∏≠‡∏Å UI ‡πÉ‡∏´‡πâ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï

```
‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 82‚Äì103: void setDestination(name, routeId)
```
- ‡∏ï‡∏±‡πâ‡∏á‡∏à‡∏∏‡∏î‡∏´‡∏°‡∏≤‡∏¢‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á
- ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏à‡∏∏‡∏î‡∏´‡∏°‡∏≤‡∏¢ ‚Üí ‡πÄ‡∏õ‡∏¥‡∏î notify ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ + ‡∏ï‡∏±‡πâ‡∏á‡∏™‡∏≤‡∏¢
- ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô null ‚Üí ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏à‡∏∏‡∏î‡∏´‡∏°‡∏≤‡∏¢
- ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å `_updateClosestBus()` ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ ‚Üí ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏•‡∏¢

```
‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 106‚Äì116: LatLng? get destinationPosition
```
- ‡∏´‡∏≤‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏Ç‡∏≠‡∏á‡∏à‡∏∏‡∏î‡∏´‡∏°‡∏≤‡∏¢‡∏à‡∏≤‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≤‡∏¢ (‡∏Ñ‡πâ‡∏ô‡∏à‡∏≤‡∏Å `_allBusStops`)

```
‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 119‚Äì142: Future<void> _fetchBusStops()
```
- ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡πâ‡∏≤‡∏¢‡∏£‡∏ñ‡∏à‡∏≤‡∏Å Firestore collection `'Bus stop'`
- ‡πÅ‡∏õ‡∏•‡∏á‡∏ó‡∏∏‡∏Å document ‡πÄ‡∏õ‡πá‡∏ô Map ‡∏ó‡∏µ‡πà‡∏°‡∏µ: id, name, lat, long, route_id
- ‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ß‡πâ‡πÉ‡∏ô `_allBusStops`

```
‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 145‚Äì177: void _listenToBusLocation()
```
- ‡∏ü‡∏±‡∏á Realtime Database path `"GPS"` ‡πÅ‡∏ö‡∏ö real-time
- ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô ‚Üí ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô List ‡∏Ç‡∏≠‡∏á `Bus` object
- ‡∏Å‡∏£‡∏≠‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏£‡∏ñ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ñ‡πà‡∏≤ `lat` ‡πÅ‡∏•‡∏∞ `lng`
- ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å `_updateClosestBus()` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏ñ‡πÉ‡∏Å‡∏•‡πâ‡∏™‡∏∏‡∏î‡πÉ‡∏´‡∏°‡πà

```
‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 180‚Äì219: Future<void> _startLocationTracking()
```
1. ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤ GPS ‡πÄ‡∏õ‡∏¥‡∏î‡∏≠‡∏¢‡∏π‡πà‡πÑ‡∏´‡∏° ‚Üí ‡∏ñ‡πâ‡∏≤‡∏õ‡∏¥‡∏î return
2. ‡πÄ‡∏ä‡πá‡∏Ñ permission ‚Üí ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÉ‡∏´‡πâ ‡∏Ç‡∏≠ permission
3. ‡πÄ‡∏õ‡∏¥‡∏î `Geolocator.getPositionStream()` ‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥‡∏™‡∏π‡∏á + ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï‡∏ó‡∏∏‡∏Å ‚â•10 ‡πÄ‡∏°‡∏ï‡∏£
4. ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÉ‡∏´‡∏°‡πà ‚Üí ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï `_userPosition` ‚Üí ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å `_updateClosestBus()`

```
‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 222‚Äì364: Future<void> _updateClosestBus()  ‚≠ê ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏´‡∏•‡∏±‡∏Å (‡∏¢‡∏≤‡∏ß‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î)
```
**‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 1 (‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 222‚Äì246): ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á**
- ‡∏ß‡∏ô‡∏•‡∏π‡∏õ‡∏ó‡∏∏‡∏Å‡∏£‡∏ñ:
  - ‡∏•‡∏≠‡∏á API ‡∏Å‡πà‡∏≠‡∏ô (`RouteService.getRoadDistance`) ‚Üí ‡πÑ‡∏î‡πâ‡∏£‡∏∞‡∏¢‡∏∞‡∏ñ‡∏ô‡∏ô‡∏à‡∏£‡∏¥‡∏á
  - ‡∏ñ‡πâ‡∏≤ API fail ‚Üí ‡πÉ‡∏ä‡πâ Haversine ‡πÄ‡∏™‡πâ‡∏ô‡∏ï‡∏£‡∏á‡πÅ‡∏ó‡∏ô
  - ‡∏™‡∏£‡πâ‡∏≤‡∏á Bus object ‡πÉ‡∏´‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Ñ‡πà‡∏≤ distance
- ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏£‡∏ñ‡∏à‡∏≤‡∏Å‡πÉ‡∏Å‡∏•‡πâ ‚Üí ‡πÑ‡∏Å‡∏•
- ‡πÄ‡∏Å‡πá‡∏ö‡∏£‡∏ñ‡πÉ‡∏Å‡∏•‡πâ‡∏™‡∏∏‡∏î‡πÑ‡∏ß‡πâ‡πÉ‡∏ô `_closestBus`

**‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 2 (‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 249‚Äì319): ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å target bus ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô**
- **‡∏Å‡∏£‡∏ì‡∏µ A (‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 253‚Äì309):** ‡∏°‡∏µ‡∏à‡∏∏‡∏î‡∏´‡∏°‡∏≤‡∏¢ ‚Üí ‡∏Å‡∏£‡∏≠‡∏á‡∏™‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á ‚Üí **‡πÄ‡∏ä‡πá‡∏Ñ‡∏ó‡∏¥‡∏®‡∏ó‡∏≤‡∏á** (‡∏£‡∏ñ‡∏ß‡∏¥‡πà‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏´‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡∏ß‡∏¥‡πà‡∏á‡∏´‡∏ô‡∏µ) ‚Üí ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏Å‡∏•‡πâ‡πÄ‡∏£‡∏≤‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î
- **‡∏Å‡∏£‡∏ì‡∏µ B (‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 310‚Äì315):** ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏≤‡∏¢‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏à‡∏∏‡∏î‡∏´‡∏°‡∏≤‡∏¢ ‚Üí ‡πÄ‡∏≠‡∏≤‡∏Ñ‡∏±‡∏ô‡πÉ‡∏Å‡∏•‡πâ‡∏™‡∏∏‡∏î‡∏Ç‡∏≠‡∏á‡∏™‡∏≤‡∏¢‡∏ô‡∏±‡πâ‡∏ô
- **‡∏Å‡∏£‡∏ì‡∏µ C (‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 316‚Äì319):** ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏∏‡∏Å‡∏™‡∏≤‡∏¢ ‚Üí ‡πÄ‡∏≠‡∏≤‡∏Ñ‡∏±‡∏ô‡πÉ‡∏Å‡∏•‡πâ‡∏™‡∏∏‡∏î‡πÄ‡∏•‡∏¢

**‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 3 (‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 321‚Äì360): ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô 4 ‡∏Ç‡∏±‡πâ‡∏ô**
- ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì ETA ‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á
- ‡πÄ‡∏ä‡πá‡∏Ñ‡πÅ‡∏ï‡πà‡∏•‡∏∞ Stage ‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡∏±‡∏Å‡πÑ‡∏õ‡πÄ‡∏ö‡∏≤:

| Stage | ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç | ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î |
|-------|----------|--------|
| 4 (‡∏ñ‡∏∂‡∏á‡πÅ‡∏•‡πâ‡∏ß) | ‚â§ 250 ‡πÄ‡∏°‡∏ï‡∏£ | 328‚Äì337 |
| 3 (1 ‡∏ô‡∏≤‡∏ó‡∏µ) | ETA ‚â§ 60 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ | 340‚Äì344 |
| 2 (3 ‡∏ô‡∏≤‡∏ó‡∏µ) | ETA ‚â§ 180 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ | 347‚Äì351 |
| 1 (5 ‡∏ô‡∏≤‡∏ó‡∏µ) | ETA ‚â§ 300 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ | 354‚Äì358 |

- **‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πâ‡∏≥:** ‡πÉ‡∏ä‡πâ `_lastAlertStage[busId]` ‡∏à‡∏≥‡∏ß‡πà‡∏≤‡∏Ñ‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÅ‡∏à‡πâ‡∏á‡∏ñ‡∏∂‡∏á Stage ‡πÑ‡∏´‡∏ô‡πÅ‡∏•‡πâ‡∏ß

```
‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 366‚Äì380: Future<void> _triggerAlert(...)
```
- ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å `NotificationService.alertBusNearby()` (notification + ‡∏™‡∏±‡πà‡∏ô)
- print log ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö debug

```
‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 383‚Äì422: getClosestStopInfo() + findClosestStop()
```
- ‡∏ß‡∏ô‡∏•‡∏π‡∏õ‡∏ó‡∏∏‡∏Å‡∏õ‡πâ‡∏≤‡∏¢ ‚Üí ‡∏´‡∏≤‡∏õ‡πâ‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡πÉ‡∏Å‡∏•‡πâ `_userPosition` ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î
- ‡∏Ñ‡∏∑‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°: `"‡∏ä‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≤‡∏¢ (XXXm)"`

```
‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 425‚Äì430: dispose()
```
- ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å subscription ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô memory leak)

---

# üìÅ ‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà 5: `bus_model.dart` (111 ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î) ‚Äî Model ‡∏£‡∏ñ‡∏ö‡∏±‡∏™ + ‡∏™‡∏≤‡∏¢‡∏£‡∏ñ

```
‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 3‚Äì63: class Bus
```
- Model ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏ñ‡∏ö‡∏±‡∏™ 1 ‡∏Ñ‡∏±‡∏ô
- Fields: `id`, `position (LatLng)`, `name`, `routeId`, `distanceToUser`, `driverName`, `routeColor`

```
‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 24‚Äì49: factory Bus.fromFirebase(id, data)  ‚Äî ‡πÅ‡∏õ‡∏•‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å RTDB
```
- **Nested Fix (‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 26‚Äì33):** ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ã‡πâ‡∏≠‡∏ô‡∏Å‡∏±‡∏ô‡πÑ‡∏´‡∏° (‡πÄ‡∏ä‡πà‡∏ô `bus_1.bus_1.driverName`)
  - ‡∏ñ‡πâ‡∏≤‡πÄ‡∏à‡∏≠ key ‡∏ó‡∏µ‡πà‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô id ‡∏ã‡πâ‡∏≠‡∏ô‡∏≠‡∏¢‡∏π‡πà ‚Üí ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏ä‡∏±‡πâ‡∏ô‡πÉ‡∏ô‡πÅ‡∏ó‡∏ô
- ‡∏û‡∏¥‡∏Å‡∏±‡∏î GPS ‡πÉ‡∏ä‡πâ `data['lat']`, `data['lng']` (‡∏ä‡∏±‡πâ‡∏ô‡∏ô‡∏≠‡∏Å)
- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏ô‡∏Ç‡∏±‡∏ö‡πÉ‡∏ä‡πâ `driverData` (‡∏≠‡∏≤‡∏à‡πÄ‡∏õ‡πá‡∏ô‡∏ä‡∏±‡πâ‡∏ô‡πÉ‡∏ô)
- ‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏ñ: `"‡∏£‡∏ñ‡πÄ‡∏ö‡∏≠‡∏£‡πå ${id.split('_').last}"` ‚Üí `bus_1` ‡∏Å‡∏•‡∏≤‡∏¢‡πÄ‡∏õ‡πá‡∏ô `"‡∏£‡∏ñ‡πÄ‡∏ö‡∏≠‡∏£‡πå 1"`

```
‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 52‚Äì62: Bus copyWithDistance(dist)
```
- ‡∏™‡∏£‡πâ‡∏≤‡∏á Bus ‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏µ‡πà copy ‡∏ó‡∏∏‡∏Å‡∏Ñ‡πà‡∏≤‡πÄ‡∏î‡∏¥‡∏° ‡πÅ‡∏ï‡πà‡πÉ‡∏™‡πà `distanceToUser` ‡πÉ‡∏´‡∏°‡πà (Immutable Pattern)

```
‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 66‚Äì110: class BusRoute ‚Äî Model ‡∏™‡∏≤‡∏¢‡∏£‡∏ñ
```
- Fields: `id`, `name`, `shortName`, `colorValue`
- `allRoutes` = 3 ‡∏™‡∏≤‡∏¢: Green (‡∏´‡∏ô‡πâ‡∏≤‡∏°‡∏≠), Red (‡∏´‡∏≠‡∏û‡∏±‡∏Å), Blue (‡∏õ‡∏£‡∏∞‡∏ï‡∏π‡∏á‡∏≤‡∏°)
- `fromId(id)` = ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡∏≤‡∏¢‡∏à‡∏≤‡∏Å ID (case insensitive)

---

# üìÅ ‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà 6: `bus_route_data.dart` (297 ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î) ‚Äî ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡πâ‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á (Hard-coded)

```
‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 2‚Äì20: class BusStopData ‚Äî Model ‡∏õ‡πâ‡∏≤‡∏¢‡∏£‡∏ñ
```
- Fields: `id`, `name`, `shortName`
- Override `==` ‚Üí ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏õ‡πâ‡∏≤‡∏¢‡∏î‡πâ‡∏ß‡∏¢ `id` (‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏´‡∏≤ intersection)
- Override `hashCode` ‚Üí ‡πÉ‡∏ä‡πâ `id.hashCode`

```
‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 23‚Äì78: class BusRouteData ‚Äî Model ‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏õ‡πâ‡∏≤‡∏¢
```
- Fields: `routeId`, `name`, `shortName`, `colorValue`, `stops` (List ‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏õ‡πâ‡∏≤‡∏¢), `startHour`, `endHour`
- **`isActiveAt(DateTime)` (‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 43‚Äì55):** ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏™‡∏≤‡∏¢‡∏ô‡∏µ‡πâ‡∏ß‡∏¥‡πà‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏õ‡∏•‡πà‡∏≤
  - ‡∏ñ‡πâ‡∏≤ startHour/endHour ‡πÄ‡∏õ‡πá‡∏ô null ‚Üí ‡∏ß‡∏¥‡πà‡∏á‡∏ï‡∏•‡∏≠‡∏î‡∏ß‡∏±‡∏ô (return true)
  - ‡∏ñ‡πâ‡∏≤ startHour ‚â§ endHour ‚Üí ‡πÄ‡∏ä‡πá‡∏Ñ‡∏õ‡∏Å‡∏ï‡∏¥ (‡πÄ‡∏ä‡πà‡∏ô 5 ‚â§ ‡∏ä‡∏°. < 14)
  - ‡∏ñ‡πâ‡∏≤ startHour > endHour ‚Üí **‡∏Ç‡πâ‡∏≤‡∏°‡∏ß‡∏±‡∏ô** (‡πÄ‡∏ä‡πà‡∏ô 14:00‚Äì00:00 ‚Üí ‡∏ä‡∏°. ‚â• 14 **‡∏´‡∏£‡∏∑‡∏≠** ‡∏ä‡∏°. < 0)
- `indexOfStop(id)`, `lastIndexOfStop(id)`, `allIndicesOfStop(id)` ‚Üí ‡∏´‡∏≤‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏õ‡πâ‡∏≤‡∏¢‡πÉ‡∏ô‡∏•‡∏≥‡∏î‡∏±‡∏ö
- `hasStop(id)` ‚Üí ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏õ‡πâ‡∏≤‡∏¢‡∏ô‡∏µ‡πâ‡πÉ‡∏ô‡∏™‡∏≤‡∏¢‡πÑ‡∏´‡∏°

```
‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 81‚Äì195: class BusStops ‚Äî ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡πâ‡∏≤‡∏¢‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (Static)
```
- ‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏õ‡πâ‡∏≤‡∏¢‡∏ó‡∏±‡πâ‡∏á 14 ‡∏õ‡πâ‡∏≤‡∏¢: namor, engineering, auditorium, president, arts, science, pky, ub99, wiangphayao, sanguansermsri, satit, gate3, economyCenter, ict
- `fromId(id)` ‚Üí ‡∏´‡∏≤‡∏õ‡πâ‡∏≤‡∏¢‡∏à‡∏≤‡∏Å id
- `fromName(name)` ‚Üí ‡∏´‡∏≤‡∏õ‡πâ‡∏≤‡∏¢‡∏à‡∏≤‡∏Å‡∏ä‡∏∑‡πà‡∏≠ (fuzzy match ‚Äî ‡∏Ñ‡πâ‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏ï‡πá‡∏°‡πÅ‡∏•‡∏∞ shortName)

```
‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 198‚Äì296: class BusRoutes ‚Äî ‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (Static)
```
- **S1-AM** (‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 200‚Äì217): ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß, 05:00‚Äì14:00, ‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô PKY
  - ‡∏•‡∏≥‡∏î‡∏±‡∏ö: ‡∏´‡∏ô‡πâ‡∏≤‡∏°‡∏≠ ‚Üí ‡∏ß‡∏¥‡∏®‡∏ß‡∏∞ ‚Üí ‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏° ‚Üí ‡∏≠‡∏ò‡∏¥‡∏Å‡∏≤‡∏£ ‚Üí ‡∏®‡∏¥‡∏•‡∏õ‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå ‚Üí ‡∏ß‡∏¥‡∏ó‡∏¢‡πå ‚Üí ‡∏ß‡∏¥‡∏®‡∏ß‡∏∞ ‚Üí ‡∏´‡∏ô‡πâ‡∏≤‡∏°‡∏≠
- **S1-PM** (‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 220‚Äì238): ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß, 14:00‚Äì00:00, **‡∏ú‡πà‡∏≤‡∏ô PKY**
  - ‡∏•‡∏≥‡∏î‡∏±‡∏ö‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÅ‡∏ï‡πà‡πÄ‡∏û‡∏¥‡πà‡∏° PKY ‡∏´‡∏•‡∏±‡∏á‡∏≠‡∏ò‡∏¥‡∏Å‡∏≤‡∏£
- **S2** (‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 241‚Äì261): ‡πÅ‡∏î‡∏á, ‡∏ß‡∏¥‡πà‡∏á‡∏ï‡∏•‡∏≠‡∏î‡∏ß‡∏±‡∏ô
  - ‡∏•‡∏≥‡∏î‡∏±‡∏ö: PKY ‚Üí UB99 ‚Üí ‡πÄ‡∏ß‡∏µ‡∏¢‡∏á ‚Üí ‡∏™‡∏á‡∏ß‡∏ô ‚Üí ‡∏™‡∏≤‡∏ò‡∏¥‡∏ï ‚Üí ‡∏™‡∏á‡∏ß‡∏ô ‚Üí ‡πÄ‡∏ß‡∏µ‡∏¢‡∏á ‚Üí UB99 ‚Üí ‡∏®‡∏¥‡∏•‡∏õ‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå ‚Üí ‡∏ß‡∏¥‡∏ó‡∏¢‡πå ‚Üí ‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏° ‚Üí ‡∏≠‡∏ò‡∏¥‡∏Å‡∏≤‡∏£ ‚Üí PKY
- **S3** (‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 264‚Äì280): ‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô, ‡∏ß‡∏¥‡πà‡∏á‡∏ï‡∏•‡∏≠‡∏î‡∏ß‡∏±‡∏ô
  - ‡∏•‡∏≥‡∏î‡∏±‡∏ö: ‡∏õ‡∏£‡∏∞‡∏ï‡∏π3 ‚Üí ‡∏®‡∏π‡∏ô‡∏¢‡πå‡πÄ‡∏®‡∏£‡∏©‡∏ê‡∏Å‡∏¥‡∏à ‚Üí ‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏° ‚Üí ‡∏≠‡∏ò‡∏¥‡∏Å‡∏≤‡∏£ ‚Üí ‡∏®‡∏¥‡∏•‡∏õ‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå ‚Üí ‡∏ß‡∏¥‡∏ó‡∏¢‡πå ‚Üí ‡∏ß‡∏¥‡∏®‡∏ß‡∏∞ ‚Üí ICT ‚Üí ‡∏®‡∏π‡∏ô‡∏¢‡πå‡πÄ‡∏®‡∏£‡∏©‡∏ê‡∏Å‡∏¥‡∏à ‚Üí ‡∏õ‡∏£‡∏∞‡∏ï‡∏π3

- `getActiveRoutes(time)` ‚Üí ‡∏´‡∏≤‡∏™‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡∏ß‡∏¥‡πà‡∏á‡∏≠‡∏¢‡∏π‡πà‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ
- `getRoutesWithStop(stopId)` ‚Üí ‡∏´‡∏≤‡∏™‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ô‡∏õ‡πâ‡∏≤‡∏¢‡∏ô‡∏µ‡πâ

---

# üìÅ ‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà 7: `route_planner_service.dart` (641 ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î) ‚Äî ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á ‚≠ê

```
‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 5‚Äì27: class RouteResult ‚Äî ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏Å‡∏≤‡∏£‡∏´‡∏≤‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á
```
- `found` ‚Üí ‡∏û‡∏ö‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
- `segments` ‚Üí List ‡∏Ç‡∏≠‡∏á‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á (RouteSegment)
- `message` ‚Üí ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ (‡πÄ‡∏ä‡πà‡∏ô "‡∏Ç‡∏∂‡πâ‡∏ô S1 ‡πÑ‡∏õ‡∏•‡∏á PKY")
- `timeNote` ‚Üí ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡πÄ‡∏ß‡∏•‡∏≤ (‡πÄ‡∏ä‡πà‡∏ô "S1 ‡∏ß‡∏¥‡πà‡∏á‡∏´‡∏•‡∏±‡∏á 14:00")
- `transferCount` ‚Üí ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πà‡∏≠‡∏£‡∏ñ
- `isDirect` ‚Üí ‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡∏ï‡∏£‡∏á (1 segment) ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà

```
‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 30‚Äì47: class RouteSegment ‚Äî ‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á 1 ‡∏™‡∏≤‡∏¢
```
- ‡πÄ‡∏Å‡πá‡∏ö: ‡∏™‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ, ‡∏õ‡πâ‡∏≤‡∏¢‡∏ï‡πâ‡∏ô, ‡∏õ‡πâ‡∏≤‡∏¢‡∏õ‡∏•‡∏≤‡∏¢, ‡∏õ‡πâ‡∏≤‡∏¢‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏ó‡∏≤‡∏á, ‡πÄ‡∏õ‡πá‡∏ô loop ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
- `stopCount` = ‡∏õ‡πâ‡∏≤‡∏¢‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏ó‡∏≤‡∏á + 1

```
‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 52‚Äì66: findRoute() ‚Äî ‡∏´‡∏≤‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î
```
- ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å `findAllRoutes()` ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏≠‡∏≤‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡πÅ‡∏£‡∏Å (‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î)

```
‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 69‚Äì178: findAllRoutes()  ‚≠ê ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏´‡∏•‡∏±‡∏Å
```
**Flow:**
1. ‡∏´‡∏≤‡∏™‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡∏ß‡∏¥‡πà‡∏á‡∏≠‡∏¢‡∏π‡πà‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ (`getActiveRoutes`)
2. ‡∏´‡∏≤‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á **‡∏ï‡∏£‡∏á** ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏à‡∏≤‡∏Å‡∏™‡∏≤‡∏¢ active
3. ‡∏´‡∏≤‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á **‡∏ï‡πà‡∏≠‡∏£‡∏ñ** ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏à‡∏≤‡∏Å‡∏™‡∏≤‡∏¢ active
4. ‡∏´‡∏≤‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡∏à‡∏≤‡∏Å **‡∏ó‡∏∏‡∏Å‡∏™‡∏≤‡∏¢** (‡∏£‡∏ß‡∏°‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ß‡∏¥‡πà‡∏á) + ‡πÉ‡∏™‡πà timeNote
5. ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏° **Weighted Score** (‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ô‡πâ‡∏≠‡∏¢ = ‡∏î‡∏µ)
6. ‡∏•‡∏ö‡∏ú‡∏•‡∏ã‡πâ‡∏≥ (dedup ‡∏î‡πâ‡∏ß‡∏¢ key = ‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏¢‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î)
7. ‡∏Ñ‡∏∑‡∏ô **3 ‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡πÅ‡∏£‡∏Å**

```
‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 182‚Äì198: _calculateWeightedScore()  ‚≠ê ‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô
```
- **‡∏™‡∏π‡∏ï‡∏£:** ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô = ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏õ‡πâ‡∏≤‡∏¢ + penalty
- Penalty ‡∏ß‡∏ô‡∏£‡∏ñ (loop): **+20** ‡∏ï‡πà‡∏≠ segment ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ß‡∏ô
- Penalty ‡∏ï‡πà‡∏≠‡∏£‡∏ñ (transfer): **+5** ‡∏ï‡πà‡∏≠‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏≤‡∏¢
- **‡∏¢‡∏¥‡πà‡∏á‡∏ô‡πâ‡∏≠‡∏¢‡∏¢‡∏¥‡πà‡∏á‡∏î‡∏µ**

```
‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 260‚Äì263: _isCircular() ‚Äî ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏ß‡∏á‡∏Å‡∏•‡∏°‡πÑ‡∏´‡∏°
```
- ‡∏î‡∏π‡∏á‡πà‡∏≤‡∏¢‡πÜ: ‡∏õ‡πâ‡∏≤‡∏¢‡πÅ‡∏£‡∏Å == ‡∏õ‡πâ‡∏≤‡∏¢‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢ ‚Üí ‡πÄ‡∏õ‡πá‡∏ô‡∏ß‡∏á‡∏Å‡∏•‡∏°

```
‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 266‚Äì278: _calculateStopCount() ‚Äî ‡∏ô‡∏±‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏õ‡πâ‡∏≤‡∏¢
```
- ‡∏Å‡∏£‡∏ì‡∏µ‡∏õ‡∏Å‡∏ï‡∏¥ (fromIdx < toIdx): `toIdx - fromIdx`
- ‡∏Å‡∏£‡∏ì‡∏µ‡∏ß‡∏ô‡∏•‡∏π‡∏õ (fromIdx > toIdx, circular): `(total - 1 - fromIdx) + toIdx`
- ‡∏Å‡∏£‡∏ì‡∏µ‡∏≠‡∏∑‡πà‡∏ô: return 999 (‡πÑ‡∏õ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ)

```
‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 281‚Äì301: _getStopsInBetween() ‚Äî ‡∏î‡∏∂‡∏á‡∏õ‡πâ‡∏≤‡∏¢‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏ó‡∏≤‡∏á
```
- ‡∏Å‡∏£‡∏ì‡∏µ‡∏õ‡∏Å‡∏ï‡∏¥: ‡πÄ‡∏Å‡πá‡∏ö‡∏õ‡πâ‡∏≤‡∏¢‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á fromIdx+1 ‡∏ñ‡∏∂‡∏á toIdx-1
- ‡∏Å‡∏£‡∏ì‡∏µ‡∏ß‡∏ô‡∏•‡∏π‡∏õ: ‡πÄ‡∏Å‡πá‡∏ö‡∏à‡∏≤‡∏Å fromIdx+1 ‚Üí ‡∏™‡∏∏‡∏î‡∏™‡∏≤‡∏¢ ‚Üí ‡∏ß‡∏ô‡∏Å‡∏•‡∏±‡∏ö 1 ‚Üí toIdx-1

```
‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 323‚Äì367: _splitIfPassingTerminal() ‚Äî ‡πÅ‡∏ö‡πà‡∏á segment ‡∏ñ‡πâ‡∏≤‡∏ú‡πà‡∏≤‡∏ô PKY/‡∏õ‡∏£‡∏∞‡∏ï‡∏π3
```
- ‡∏ñ‡πâ‡∏≤‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á **‡∏ú‡πà‡∏≤‡∏ô terminal** (PKY ‡∏´‡∏£‡∏∑‡∏≠ ‡∏õ‡∏£‡∏∞‡∏ï‡∏π3) ‚Üí ‡πÅ‡∏ö‡πà‡∏á‡πÄ‡∏õ‡πá‡∏ô 2 ‡∏™‡πà‡∏ß‡∏ô
- ‡∏ó‡∏≥‡πÉ‡∏´‡πâ UI ‡πÅ‡∏™‡∏î‡∏á "‡∏•‡∏á‡∏ó‡∏µ‡πà PKY ‚Üí ‡∏ï‡πà‡∏≠ S1 ‡πÑ‡∏õ xxx" ‡πÑ‡∏î‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á

```
‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 369‚Äì421: _findAllDirectRoutes() ‚Äî ‡∏´‡∏≤‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡∏ï‡∏£‡∏á
```
- ‡∏ß‡∏ô‡∏ó‡∏∏‡∏Å‡∏™‡∏≤‡∏¢ ‚Üí ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏ó‡∏±‡πâ‡∏á fromStop ‡πÅ‡∏•‡∏∞ toStop ‡πÑ‡∏´‡∏°
- ‡∏•‡∏≠‡∏á‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏π‡πà indices (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏õ‡πâ‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏´‡∏•‡∏≤‡∏¢‡∏à‡∏∏‡∏î‡πÉ‡∏ô‡∏™‡∏≤‡∏¢ loop)
- ‡∏™‡∏£‡πâ‡∏≤‡∏á RouteResult ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏π‡πà‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏õ‡πÑ‡∏î‡πâ

```
‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 425‚Äì571: _findAllTransferRoutes() ‚Äî ‡∏´‡∏≤‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡∏ï‡πà‡∏≠‡∏£‡∏ñ
```
- ‡∏´‡∏≤‡∏™‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ô‡∏ï‡πâ‡∏ô‡∏ó‡∏≤‡∏á + ‡∏´‡∏≤‡∏™‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ô‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á
- ‡∏ß‡∏ô‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏π‡πà‡∏™‡∏≤‡∏¢ ‚Üí ‡∏´‡∏≤‡∏à‡∏∏‡∏î‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏≤‡∏¢
- **‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏ï‡πà‡∏≠‡∏£‡∏ñ‡∏™‡∏≤‡∏¢‡πÄ‡∏î‡∏¥‡∏°** ‡∏¢‡∏Å‡πÄ‡∏ß‡πâ‡∏ô‡∏ó‡∏µ‡πà terminal (PKY, ‡∏õ‡∏£‡∏∞‡∏ï‡∏π3, ‡∏ß‡∏¥‡∏®‡∏ß‡∏∞)
- ‡∏•‡∏≠‡∏á‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏π‡πà indices ‚Üí ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì stopCount ‚Üí ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å best

```
‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 574‚Äì581: _findTransferPoints() ‚Äî ‡∏´‡∏≤‡∏à‡∏∏‡∏î‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏≤‡∏¢ (Set Intersection)
```
- ‡πÄ‡∏≠‡∏≤‡∏õ‡πâ‡∏≤‡∏¢‡∏™‡∏≤‡∏¢ 1 ‚Üí Set, ‡∏õ‡πâ‡∏≤‡∏¢‡∏™‡∏≤‡∏¢ 2 ‚Üí Set ‚Üí ‡∏´‡∏≤ `.intersection()`

```
‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 584‚Äì639: mapFirebaseIdToStopId() ‚Äî ‡πÅ‡∏õ‡∏•‡∏á Firebase ID ‡πÄ‡∏õ‡πá‡∏ô internal ID
```
- ‡∏•‡∏≠‡∏á‡∏Ñ‡πâ‡∏ô‡∏à‡∏≤‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡πà‡∏≠‡∏ô (`BusStops.fromName`)
- ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÄ‡∏à‡∏≠ ‚Üí ‡πÉ‡∏ä‡πâ keyword matching (‡πÄ‡∏ä‡πà‡∏ô "‡∏´‡∏ô‡πâ‡∏≤‡∏°‡∏≠" ‚Üí `namor`, "‡∏ß‡∏¥‡∏®‡∏ß" ‚Üí `engineering`)

---

# üìÅ ‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà 8: `login_page.dart` (273 ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î) ‚Äî ‡∏´‡∏ô‡πâ‡∏≤‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô

```
‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 11‚Äì15: ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ State
```
- `_emailController`, `_passwordController` ‚Üí ‡∏à‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏û‡∏¥‡∏°‡∏û‡πå
- `_isLoading` ‚Üí ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏≠‡∏¢‡∏π‡πà‡πÑ‡∏´‡∏° (‡πÅ‡∏™‡∏î‡∏á‡∏ß‡∏á‡∏Å‡∏•‡∏°‡∏´‡∏°‡∏∏‡∏ô)
- `_obscurePassword` ‚Üí ‡∏ã‡πà‡∏≠‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô (‚óè‚óè‚óè) ‡∏´‡∏£‡∏∑‡∏≠‡πÅ‡∏™‡∏î‡∏á

```
‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 18‚Äì21: Email lists
```
- `driverEmails` = email ‡∏Ñ‡∏ô‡∏Ç‡∏±‡∏ö (‡∏ï‡∏£‡∏ß‡∏à‡∏´‡∏•‡∏±‡∏á‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô)
- `managerEmails` = email ‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£

```
‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 23‚Äì69: _handleLogin()
```
1. ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å `FirebaseAuth.signInWithEmailAndPassword()` ‚Üí ‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô
2. ‡πÄ‡∏ä‡πá‡∏Ñ email:
   - ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô `managerEmails` ‚Üí ‡πÑ‡∏õ `ManagerPage`
   - ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô `driverEmails` ‚Üí ‡πÑ‡∏õ `ChangeRoutePage`
   - ‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‚Üí `Navigator.pop()` ‡∏Å‡∏•‡∏±‡∏ö‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà (‡∏ú‡∏π‡πâ‡πÇ‡∏î‡∏¢‡∏™‡∏≤‡∏£)
3. ‡∏ñ‡πâ‡∏≤ error ‚Üí ‡πÅ‡∏™‡∏î‡∏á SnackBar

```
‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 73‚Äì271: build() ‚Äî ‡∏™‡∏£‡πâ‡∏≤‡∏á UI
```
- ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á: Gradient ‡∏™‡∏µ‡∏°‡πà‡∏ß‡∏á ‚Üí ‡∏°‡πà‡∏ß‡∏á‡∏≠‡πà‡∏≠‡∏ô ‚Üí ‡∏ä‡∏°‡∏û‡∏π
- ‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡∏£‡∏ñ‡∏ö‡∏±‡∏™‡∏ß‡∏á‡∏Å‡∏•‡∏° + ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° "UP BUS"
- ‡∏ä‡πà‡∏≠‡∏á email + password (‡∏°‡∏µ‡∏õ‡∏∏‡πà‡∏°‡πÅ‡∏™‡∏î‡∏á/‡∏ã‡πà‡∏≠‡∏ô)
- ‡∏õ‡∏∏‡πà‡∏° "‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö" Gradient ‡∏™‡∏µ‡∏°‡πà‡∏ß‡∏á ‡∏û‡∏£‡πâ‡∏≠‡∏° shadow

---

# üìÅ ‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà 9: `sidemenu.dart` (186 ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î) ‚Äî ‡πÄ‡∏°‡∏ô‡∏π‡∏î‡πâ‡∏≤‡∏ô‡∏Ç‡πâ‡∏≤‡∏á

```
‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 15‚Äì23: ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£
```
- `driverEmails` = ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠ email ‡∏Ñ‡∏ô‡∏Ç‡∏±‡∏ö
- `managerEmails` = ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠ email ‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£

```
‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 26‚Äì183: build() ‚Äî ‡∏™‡∏£‡πâ‡∏≤‡∏á Drawer
```
- ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô: `FirebaseAuth.instance.currentUser`
- Header: ‡∏ß‡∏á‡∏Å‡∏•‡∏°‡∏£‡∏π‡∏õ‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå + email + badge "‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£" (‡∏ñ‡πâ‡∏≤‡πÉ‡∏ä‡πà)
- **‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏°‡∏ô‡∏π‡∏ï‡∏≤‡∏°‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó:**
  - ‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ ‚Üí "‡∏´‡∏ô‡πâ‡∏≤‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£"
  - ‡∏Ñ‡∏ô‡∏Ç‡∏±‡∏ö ‚Üí "‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏ô‡∏£‡∏ñ"
  - ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà login ‚Üí "‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö"
  - login ‡πÅ‡∏•‡πâ‡∏ß ‚Üí "Logout" (‡∏•‡πâ‡∏≤‡∏á SharedPreferences + signOut)

---

# üìÅ ‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà 10: `route-page.dart` (253 ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î) ‚Äî ‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á (‡∏î‡∏π‡∏£‡∏π‡∏õ)

```
‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 11‚Äì31: State
```
- `_selectedRouteView` = 0 (‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°), 1 (‡∏´‡∏ô‡πâ‡∏≤‡∏°‡∏≠), 2 (‡∏´‡∏≠‡πÉ‡∏ô), 3 (ICT)
- `_currentRouteImage` ‚Üí ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏à‡∏≤‡∏Å assets ‡∏ï‡∏≤‡∏° index

```
‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 34‚Äì116: build()
```
- `InteractiveViewer` ‚Üí ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏ã‡∏π‡∏°‡πÑ‡∏î‡πâ (pinch zoom, min 0.5x max 5x)
- ‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏£‡∏≠‡∏á 4 ‡∏õ‡∏∏‡πà‡∏°: ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏° (‡∏°‡πà‡∏ß‡∏á), ‡∏´‡∏ô‡πâ‡∏≤‡∏°‡∏≠ (‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß), ‡∏´‡∏≠‡πÉ‡∏ô (‡πÅ‡∏î‡∏á), ICT (‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô)

```
‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 119‚Äì138: _routeFilterButton()
```
- ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏õ‡∏∏‡πà‡∏° ElevatedButton ‡∏û‡∏£‡πâ‡∏≠‡∏° animation (‡∏Ç‡∏≠‡∏ö‡∏Ç‡∏≤‡∏ß + ‡πÄ‡∏á‡∏≤ ‡πÄ‡∏°‡∏∑‡πà‡∏≠ selected)

---

# üìÅ ‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà 11: `feedback-page.dart` (356 ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î) ‚Äî ‡∏´‡∏ô‡πâ‡∏≤‡∏™‡πà‡∏á Feedback

```
‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 5: enum FeedbackMode { complain, rating }
```
- 2 ‡πÇ‡∏´‡∏°‡∏î: ‡∏£‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô ‡∏´‡∏£‡∏∑‡∏≠ ‡πÉ‡∏´‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô

```
‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 30‚Äì185: build()
```
- ‡∏õ‡∏∏‡πà‡∏°‡∏™‡∏•‡∏±‡∏ö Complain/Rating
- ‡∏ñ‡πâ‡∏≤ Rating: ‡πÅ‡∏™‡∏î‡∏á‡∏î‡∏≤‡∏ß 5 ‡∏î‡∏ß‡∏á + ‡∏ä‡πà‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞
- ‡∏ñ‡πâ‡∏≤ Complain: ‡πÅ‡∏™‡∏î‡∏á‡∏ä‡πà‡∏≠‡∏á‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏õ‡∏±‡∏ç‡∏´‡∏≤
- ‡∏õ‡∏∏‡πà‡∏° Submit ‡∏™‡∏µ‡∏°‡πà‡∏ß‡∏á

```
‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 187‚Äì230: _onSubmit()
```
1. Validate: ‡∏ñ‡πâ‡∏≤ rating mode ‚Üí ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏î‡∏≤‡∏ß, ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
2. ‡∏™‡∏£‡πâ‡∏≤‡∏á Map data: `{ message, type, timestamp, rating? }`
3. ‡∏™‡πà‡∏á‡πÑ‡∏õ Firestore collection `'feedback'`
4. ‡πÅ‡∏™‡∏î‡∏á SnackBar "‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢"

---

# üìÅ ‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà 12: `busstop_map_page.dart` (269 ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î) ‚Äî ‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏õ‡πâ‡∏≤‡∏¢

```
‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 29‚Äì53: _fetchBusStops()
```
- ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡πâ‡∏≤‡∏¢‡∏à‡∏≤‡∏Å Firestore ‚Üí ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏õ‡πá‡∏ô Marker ‡∏ö‡∏ô‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà

```
‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 56‚Äì76: didChangeDependencies()
```
- ‡∏£‡∏±‡∏ö arguments ‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡πâ‡∏≤ BusStop (lat, long, name, id)
- ‡∏¢‡πâ‡∏≤‡∏¢‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏õ‡∏õ‡πâ‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å + ‡πÄ‡∏õ‡∏¥‡∏î Popup ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥

```
‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 80‚Äì130: _buildRouteChips()
```
- ‡∏™‡∏£‡πâ‡∏≤‡∏á Chip ‡∏™‡∏µ‡∏ï‡∏≤‡∏°‡∏™‡∏≤‡∏¢: S1=‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß, S2=‡πÅ‡∏î‡∏á, S3=‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô
- ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏ó‡∏±‡πâ‡∏á List ‡πÅ‡∏•‡∏∞ String

```
‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 132‚Äì267: build()
```
- `FlutterMap` ‡∏û‡∏£‡πâ‡∏≠‡∏° OpenStreetMap tiles
- **Layer 1:** Marker ‡∏õ‡πâ‡∏≤‡∏¢‡∏£‡∏ñ‡∏ó‡∏∏‡∏Å‡∏õ‡πâ‡∏≤‡∏¢ (‡∏Å‡∏î‡∏î‡∏π Popup ‡∏ä‡∏∑‡πà‡∏≠+‡∏™‡∏≤‡∏¢)
- **Layer 2:** ‡∏´‡∏°‡∏∏‡∏î‡πÅ‡∏î‡∏á‡∏õ‡∏±‡∏Å‡∏ó‡∏µ‡πà‡∏õ‡πâ‡∏≤‡∏¢‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ (‡πÉ‡∏ä‡πâ `IgnorePointer` ‡πÉ‡∏´‡πâ‡∏Å‡∏î‡∏ó‡∏∞‡∏•‡∏∏‡πÑ‡∏î‡πâ)
- FAB ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏õ‡πâ‡∏≤‡∏¢‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢

---

# üìÅ ‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà 13: `busstop-page.dart` (819 ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î) ‚Äî ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏õ‡πâ‡∏≤‡∏¢‡∏£‡∏ñ

```
‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 14‚Äì55: State
```
- `_selectedLine` = ‡∏™‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å (yellow/red/blue)
- `_searchQuery` = ‡∏Ñ‡∏≥‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤
- `_targetHighlightName` = ‡∏õ‡πâ‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á highlight (‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡∏≠‡∏∑‡πà‡∏ô‡∏™‡πà‡∏á‡∏°‡∏≤)
- `_shouldScroll` = flag ‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏õ‡∏´‡∏≤‡∏õ‡πâ‡∏≤‡∏¢‡∏ô‡∏±‡πâ‡∏ô‡πÑ‡∏´‡∏°

```
‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 57‚Äì106: didChangeDependencies() + _handleRouteIdSwitch()
```
- ‡∏£‡∏±‡∏ö arguments ‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡∏≠‡∏∑‡πà‡∏ô (‡∏ä‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≤‡∏¢, ‡∏™‡∏≤‡∏¢)
- ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô Tab ‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏™‡∏≤‡∏¢

```
‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 113‚Äì473: build()
```
- ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏≤‡∏¢ 3 ‡∏õ‡∏∏‡πà‡∏° (‡∏ß‡∏á‡∏Å‡∏•‡∏°‡∏™‡∏µ S1/S2/S3)
- ‡∏ä‡πà‡∏≠‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏õ‡πâ‡∏≤‡∏¢
- `StreamBuilder` ‡∏ü‡∏±‡∏á Firestore ‚Üí ‡∏Å‡∏£‡∏≠‡∏á‡∏ï‡∏≤‡∏°‡∏™‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡∏ä‡∏∑‡πà‡∏≠ ‚Üí ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏õ‡πâ‡∏≤‡∏¢
- **Auto-scroll** ‡πÑ‡∏õ‡∏õ‡πâ‡∏≤‡∏¢‡∏ó‡∏µ‡πà highlight (‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏à‡∏≤‡∏Å index √ó 75px)

---

# üìÅ ‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà 14: `plan-page.dart` (1,512 ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î) ‚Äî ‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á

‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡∏ç‡πà‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î ‚Äî ‡∏™‡πà‡∏ß‡∏ô‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç:

- **Dropdown ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡πâ‡∏ô‡∏ó‡∏≤‡∏á-‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á** ‡∏à‡∏≤‡∏Å‡∏õ‡πâ‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡∏î‡∏∂‡∏á‡∏à‡∏≤‡∏Å Firestore
- **‡∏Å‡∏î‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤** ‚Üí ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å `RoutePlannerService.findAllRoutes()`
- **‡∏ß‡∏≤‡∏î‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á** ‡∏ö‡∏ô‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà (‡∏à‡∏±‡∏ö‡∏Ñ‡∏π‡πà GeoJSON coordinates)
- **‡πÅ‡∏™‡∏î‡∏á Route Result Cards** (‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥ + ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å 2, 3)
- **Timeline UI** ‡πÅ‡∏™‡∏î‡∏á node ‡∏ï‡πâ‡∏ô‡∏ó‡∏≤‡∏á ‚Üí ‡∏à‡∏∏‡∏î‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô ‚Üí ‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡∏µ‡∏™‡∏≤‡∏¢

---

# üìÅ ‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà 15: `change_route_page.dart` (624 ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î) ‚Äî ‡∏´‡∏ô‡πâ‡∏≤‡∏Ñ‡∏ô‡∏Ç‡∏±‡∏ö

- **‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏ô‡∏Ç‡∏±‡∏ö** (‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ô SharedPreferences)
- **‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏£‡∏ñ + ‡∏™‡∏≤‡∏¢** ‡∏à‡∏≤‡∏Å Dropdown
- **‡∏à‡∏≠‡∏á‡∏£‡∏ñ** ‚Üí ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ RTDB path `GPS/{busId}` (‡∏Ñ‡πà‡∏≤: driverName, routeColor)
- **‡∏õ‡∏•‡πà‡∏≠‡∏¢‡∏£‡∏ñ** ‚Üí ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å RTDB
- **‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏£‡∏ñ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î** (‡∏ß‡πà‡∏≤‡∏á/‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏á)

---

# üìÅ ‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà 16: `manager_page.dart` (1,007 ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î) ‚Äî ‡∏´‡∏ô‡πâ‡∏≤‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£

- **Tab 1 ‚Äî Feedback Report:**
  - ‡∏î‡∏∂‡∏á feedback ‡∏à‡∏≤‡∏Å Firestore
  - ‡∏Å‡∏£‡∏≠‡∏á: ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î / ‡∏£‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô / ‡πÉ‡∏´‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô + ‡∏Å‡∏£‡∏≠‡∏á‡∏ï‡∏≤‡∏°‡∏™‡∏≤‡∏¢
  - ‡πÅ‡∏™‡∏î‡∏á Card ‡πÅ‡∏ï‡πà‡∏•‡∏∞ feedback ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏î‡∏≤‡∏ß rating
  - ‡∏Å‡∏î‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÉ‡∏ô Dialog

- **Tab 2 ‚Äî Driver Report:**
  - ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å RTDB path `'GPS'`
  - ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡∏ô‡∏Ç‡∏±‡∏ö + ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ active/offline + ‡∏™‡∏≤‡∏¢ + ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏£‡∏ñ
  - ‡∏Å‡∏î‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÉ‡∏ô Dialog

---

# üìÅ ‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà 17: `upbus-page.dart` (1,373 ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î) ‚Äî ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å LIVE MAP ‚≠ê

‡πÑ‡∏ü‡∏•‡πå‡∏´‡∏•‡∏±‡∏Å‡∏Ç‡∏≠‡∏á‡πÅ‡∏≠‡∏õ ‚Äî ‡∏™‡πà‡∏ß‡∏ô‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç:

- **‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á** ‡∏à‡∏≤‡∏Å GeoJSON 3 ‡πÑ‡∏ü‡∏•‡πå + ‡∏î‡∏∂‡∏á‡∏õ‡πâ‡∏≤‡∏¢‡∏à‡∏≤‡∏Å Firestore + ‡∏ü‡∏±‡∏á RTDB
- **FlutterMap** ‡πÅ‡∏™‡∏î‡∏á‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà OpenStreetMap + Polyline ‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á + Marker ‡∏£‡∏ñ + Marker ‡∏õ‡πâ‡∏≤‡∏¢
- **‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏£‡∏≠‡∏á‡∏™‡∏≤‡∏¢** (Green/Red/Blue) + toggle ‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î
- **Dialog ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏∏‡∏î‡∏´‡∏°‡∏≤‡∏¢** ‚Üí ‡∏î‡∏∂‡∏á‡∏õ‡πâ‡∏≤‡∏¢‡∏à‡∏≤‡∏Å Firestore ‚Üí ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å `setDestination()`
- **Dialog ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏≤‡∏¢‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô** ‚Üí ‡∏ó‡∏∏‡∏Å‡∏™‡∏≤‡∏¢ / ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏™‡∏µ + ‡∏õ‡∏∏‡πà‡∏°‡∏õ‡∏¥‡∏î
- **Proximity Alert Box** ‚Üí ‡∏Å‡∏•‡πà‡∏≠‡∏á‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏£‡∏ñ‡πÉ‡∏Å‡∏•‡πâ‡∏ñ‡∏∂‡∏á + countdown ETA + animation ‡∏Å‡∏£‡∏∞‡∏û‡∏£‡∏¥‡∏ö
- **Bottom Navigation** ‚Üí 5 ‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô (Map, Stop, Route, Plan, Feed)

---

# üìÅ ‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà 18: `global_debug_bar.dart` (15 ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î) ‚Äî Debug Wrapper (‡∏õ‡∏¥‡∏î‡πÅ‡∏•‡πâ‡∏ß)

```
‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 4‚Äì14: class GlobalDebugBarWrapper
```
- ‡πÄ‡∏õ‡πá‡∏ô StatelessWidget ‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö `child` ‡πÅ‡∏•‡πâ‡∏ß return `child` ‡∏ï‡∏£‡∏á‡πÜ
- **‡πÑ‡∏°‡πà‡∏ó‡∏≥‡∏≠‡∏∞‡πÑ‡∏£** (debug bar ‡∏ñ‡∏π‡∏Å‡∏õ‡∏¥‡∏î‡πÅ‡∏•‡πâ‡∏ß) ‚Äî ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÑ‡∏ß‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡πÇ‡∏Ñ‡πâ‡∏î‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ error

---

# üìä ‡∏™‡∏£‡∏∏‡∏õ Dependencies ‡∏´‡∏•‡∏±‡∏Å

| Package | ‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö |
|---------|----------|
| `firebase_core` | ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô Firebase |
| `cloud_firestore` | ‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Firestore (‡∏õ‡πâ‡∏≤‡∏¢‡∏£‡∏ñ, Feedback) |
| `firebase_database` | Realtime Database (‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á GPS ‡∏£‡∏ñ) |
| `firebase_auth` | ‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô (Email/Password) |
| `flutter_map` | ‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà OpenStreetMap |
| `latlong2` | ‡∏Ñ‡∏•‡∏≤‡∏™‡∏û‡∏¥‡∏Å‡∏±‡∏î LatLng |
| `geolocator` | ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏° GPS ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ |
| `flutter_local_notifications` | Push Notification ‡∏ö‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á |
| `vibration` | ‡∏™‡∏±‡πà‡∏ô‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô |
| `provider` | State Management (‡πÅ‡∏ä‡∏£‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡πâ‡∏≤‡∏°‡∏´‡∏ô‡πâ‡∏≤) |
| `shared_preferences` | ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á (‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏ô‡∏Ç‡∏±‡∏ö) |
| `http` | ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å API |
| `flutter_map_animations` | Animation ‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà |

---

# üîÑ Flow ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÇ‡∏î‡∏¢‡∏£‡∏ß‡∏°

```
‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏≠‡∏õ
  ‚Üí main.dart ‡∏™‡∏£‡πâ‡∏≤‡∏á GlobalLocationService + Firebase
  ‚Üí ‡πÅ‡∏™‡∏î‡∏á‡∏´‡∏ô‡πâ‡∏≤ UpBusHomePage (Live Map)
    ‚Üí ‡πÇ‡∏´‡∏•‡∏î GeoJSON ‚Üí ‡∏ß‡∏≤‡∏î‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á
    ‚Üí ‡∏ü‡∏±‡∏á RTDB ‚Üí ‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏£‡∏ñ real-time
    ‚Üí ‡∏ü‡∏±‡∏á GPS ‚Üí ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ

‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏Å‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏∏‡∏î‡∏´‡∏°‡∏≤‡∏¢
  ‚Üí setDestination() ‚Üí ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏∞‡∏¢‡∏∞ ‚Üí ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ó‡∏¥‡∏®‡∏ó‡∏≤‡∏á
  ‚Üí ‡∏ñ‡πâ‡∏≤ ETA ‚â§ 5/3/1 ‡∏ô‡∏≤‡∏ó‡∏µ ‡∏´‡∏£‡∏∑‡∏≠ ‚â§ 250m ‚Üí ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô (notification + ‡∏™‡∏±‡πà‡∏ô)

‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏Å‡∏î‡πÅ‡∏û‡∏•‡∏ô
  ‚Üí PlanPage ‚Üí ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡πâ‡∏ô‡∏ó‡∏≤‡∏á + ‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á
  ‚Üí RoutePlannerService.findAllRoutes()
  ‚Üí ‡πÅ‡∏™‡∏î‡∏á 3 ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏° Weighted Score

‡∏Ñ‡∏ô‡∏Ç‡∏±‡∏ö‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô
  ‚Üí LoginPage ‚Üí Firebase Auth ‚Üí ChangeRoutePage
  ‚Üí ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏£‡∏ñ + ‡∏™‡∏≤‡∏¢ ‚Üí ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô RTDB
  ‚Üí ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á GPS ‡∏ñ‡∏π‡∏Å‡πÅ‡∏ä‡∏£‡πå‡πÑ‡∏õ‡∏ó‡∏∏‡∏Å‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ

‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô
  ‚Üí LoginPage ‚Üí Firebase Auth ‚Üí ManagerPage
  ‚Üí ‡∏î‡∏π Feedback + Driver Report
```
