# üìã ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÇ‡∏Ñ‡πâ‡∏î‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå UP BUS

‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå **Flutter** ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏≠‡∏õ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏£‡∏ñ‡∏ö‡∏±‡∏™ "UP BUS" ‡πÉ‡∏ä‡πâ **Firebase** (Firestore, Realtime Database, Auth) ‡πÄ‡∏õ‡πá‡∏ô Backend

## ‡∏™‡∏ñ‡∏≤‡∏õ‡∏±‡∏ï‡∏¢‡∏Å‡∏£‡∏£‡∏°‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå

```
lib/
‚îú‚îÄ‚îÄ main.dart                    (68 ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î) - ‡∏à‡∏∏‡∏î‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÅ‡∏≠‡∏õ
‚îú‚îÄ‚îÄ login_page.dart              (273 ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î) - ‡∏´‡∏ô‡πâ‡∏≤‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô
‚îú‚îÄ‚îÄ upbus-page.dart              (1,373 ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î) - ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å ‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà Live
‚îú‚îÄ‚îÄ busstop-page.dart            (819 ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î) - ‡∏´‡∏ô‡πâ‡∏≤‡∏õ‡πâ‡∏≤‡∏¢‡∏£‡∏ñ
‚îú‚îÄ‚îÄ busstop_map_page.dart        (269 ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î) - ‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏õ‡πâ‡∏≤‡∏¢‡∏£‡∏ñ
‚îú‚îÄ‚îÄ route-page.dart              (253 ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î) - ‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á
‚îú‚îÄ‚îÄ plan-page.dart               (1,512 ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î) - ‡∏´‡∏ô‡πâ‡∏≤‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á
‚îú‚îÄ‚îÄ feedback-page.dart           (356 ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î) - ‡∏´‡∏ô‡πâ‡∏≤ Feedback
‚îú‚îÄ‚îÄ sidemenu.dart                (186 ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î) - ‡πÄ‡∏°‡∏ô‡∏π‡∏î‡πâ‡∏≤‡∏ô‡∏Ç‡πâ‡∏≤‡∏á
‚îú‚îÄ‚îÄ change_route_page.dart       (624 ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î) - ‡∏´‡∏ô‡πâ‡∏≤‡∏Ñ‡∏ô‡∏Ç‡∏±‡∏ö‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏≤‡∏¢
‚îú‚îÄ‚îÄ manager_page.dart            (1,007 ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î) - ‡∏´‡∏ô‡πâ‡∏≤‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£
‚îú‚îÄ‚îÄ firebase_options.dart        (99 ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î) - ‡∏Ñ‡πà‡∏≤ Firebase config
‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îú‚îÄ‚îÄ bus_model.dart           (111 ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î) - Model ‡∏£‡∏ñ‡∏ö‡∏±‡∏™ + ‡∏™‡∏≤‡∏¢‡∏£‡∏ñ
‚îÇ   ‚îî‚îÄ‚îÄ bus_route_data.dart      (297 ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î) - ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡πâ‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îú‚îÄ‚îÄ global_location_service.dart  (426 ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î) - ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏° GPS + ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
‚îÇ   ‚îú‚îÄ‚îÄ notification_service.dart     (118 ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î) - Push Notification
‚îÇ   ‚îú‚îÄ‚îÄ route_planner_service.dart    (641 ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î) - ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á
‚îÇ   ‚îî‚îÄ‚îÄ route_service.dart            (71 ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î) - OpenRouteService API
‚îî‚îÄ‚îÄ widgets/
    ‚îî‚îÄ‚îÄ global_debug_bar.dart    (15 ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î) - Debug Wrapper (‡∏õ‡∏¥‡∏î‡πÅ‡∏•‡πâ‡∏ß)
```

---

## 1. `main.dart` (68 ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î)

‡∏à‡∏∏‡∏î‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÅ‡∏≠‡∏õ ‚Äî ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Firebase, Provider, ‡πÅ‡∏•‡∏∞ Routes

| ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î | ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô/‡∏Ñ‡∏•‡∏≤‡∏™ | ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ |
|--------|--------------|----------|
| 1‚Äì21 | **Imports** | ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤ Flutter, Firebase, Provider, ‡πÅ‡∏•‡∏∞‡∏ó‡∏∏‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡πÅ‡∏≠‡∏õ |
| 22‚Äì37 | `main()` | ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏´‡∏•‡∏±‡∏Å ‚Äî `WidgetsFlutterBinding.ensureInitialized()` ‚Üí `Firebase.initializeApp()` ‚Üí ‡∏™‡∏£‡πâ‡∏≤‡∏á `GlobalLocationService` ‡πÅ‡∏•‡πâ‡∏ß‡∏´‡πà‡∏≠‡∏î‡πâ‡∏ß‡∏¢ `ChangeNotifierProvider` ‚Üí `runApp(MyApp())` |
| 39‚Äì67 | `MyApp` (StatelessWidget) | ‡∏Å‡∏≥‡∏´‡∏ô‡∏î `MaterialApp` ‡∏û‡∏£‡πâ‡∏≠‡∏° Theme ‡∏™‡∏µ‡∏°‡πà‡∏ß‡∏á, ‡∏õ‡∏¥‡∏î debug banner |
| 43‚Äì66 | `MyApp.build()` | ‡∏Å‡∏≥‡∏´‡∏ô‡∏î **Named Routes** ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: `/` ‚Üí `UpBusHomePage`, `/busStop` ‚Üí `BusStopPage`, `/route` ‚Üí `RoutePage`, `/plan` ‚Üí `PlanPage`, `/feedback` ‚Üí `FeedbackPage`, `/login` ‚Üí `LoginPage`, `/busStopMap` ‚Üí `BusStopMapPage` |

---

## 2. `login_page.dart` (273 ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î)

‡∏´‡∏ô‡πâ‡∏≤‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô Firebase Auth ‚Äî ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó Driver ‡πÅ‡∏•‡∏∞ Manager

| ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î | ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô/‡∏Ñ‡∏•‡∏≤‡∏™ | ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ |
|--------|--------------|----------|
| 1‚Äì4 | **Imports** | `firebase_auth`, `change_route_page`, `manager_page` |
| 6‚Äì9 | `LoginPage` (StatefulWidget) | Widget ‡∏´‡∏•‡∏±‡∏Å‡∏Ç‡∏≠‡∏á‡∏´‡∏ô‡πâ‡∏≤ login |
| 11‚Äì272 | `_LoginPageState` | State ‡∏´‡∏•‡∏±‡∏Å ‚Äî ‡∏°‡∏µ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ `_emailController`, `_passwordController`, `_isLoading`, `_errorMessage` |
| 23‚Äì70 | `_handleLogin()` | ‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡∏î‡πâ‡∏ß‡∏¢ `FirebaseAuth.instance.signInWithEmailAndPassword()` ‚Äî ‡∏ñ‡πâ‡∏≤ email ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠ Manager ‚Üí ‡πÑ‡∏õ `ManagerPage`, ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô Driver ‚Üí ‡πÑ‡∏õ `ChangeRoutePage`, ‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‚Üí `pop()` ‡∏Å‡∏•‡∏±‡∏ö |
| 73‚Äì271 | `build()` | ‡∏™‡∏£‡πâ‡∏≤‡∏á UI ‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô ‚Üí ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏™‡∏µ‡∏°‡πà‡∏ß‡∏á Gradient, ‡∏ä‡πà‡∏≠‡∏á Email/Password, ‡∏õ‡∏∏‡πà‡∏° "‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö", ‡πÅ‡∏™‡∏î‡∏á error message |

---

## 3. `upbus-page.dart` (1,373 ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î) ‚≠ê ‡πÑ‡∏ü‡∏•‡πå‡∏´‡∏•‡∏±‡∏Å

‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà LIVE MAP ‚Äî ‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏£‡∏ñ‡πÅ‡∏ö‡∏ö Real-time, ‡∏õ‡πâ‡∏≤‡∏¢‡∏£‡∏ñ, ‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á, ‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô

| ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î | ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô/‡∏Ñ‡∏•‡∏≤‡∏™ | ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ |
|--------|--------------|----------|
| 1‚Äì20 | **Imports** | `flutter_map`, `latlong2`, `cloud_firestore`, `firebase_database`, `geolocator`, `provider`, `notification_service`, `global_location_service`, `sidemenu`, `flutter_map_animations` |
| 21 | `selectedBusStopId` | ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ Global ‡πÄ‡∏Å‡πá‡∏ö ID ‡∏õ‡πâ‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å |
| 22‚Äì27 | `UpBusHomePage` (StatefulWidget) | Widget ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å |
| 29‚Äì1372 | `_UpBusHomePageState` | State ‡∏´‡∏•‡∏±‡∏Å ‚Äî ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç: `_mapController`, `_routePolylines`, `_busMarkers`, `_busStopMarkers`, `_activeFilters`, `_isNotificationsEnabled` ‡∏Ø‡∏•‡∏Ø |
| 48‚Äì59 | `_getBusColor(String)` | ‡πÅ‡∏õ‡∏•‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏µ ("Green"/"Red"/"Blue") ‚Üí `Color` object |
| 62‚Äì73 | `_getBusIconAsset(String)` | ‡πÅ‡∏õ‡∏•‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏µ ‚Üí path ‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡∏£‡∏ñ |
| 75‚Äì86 | `_getRouteNameTh(String)` | ‡πÅ‡∏õ‡∏•‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏µ ‚Üí ‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏¢‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢ (‡πÄ‡∏ä‡πà‡∏ô "‡∏™‡∏≤‡∏¢‡∏´‡∏ô‡πâ‡∏≤‡∏°‡∏≠") |
| 89‚Äì93 | `initState()` | ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å `_loadAllRoutes()` ‡πÅ‡∏•‡∏∞ `_initializeServices()` |
| 100‚Äì127 | `_loadAllRoutes()` | ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡∏à‡∏≤‡∏Å GeoJSON (3 ‡∏™‡∏≤‡∏¢: Green, Red, Blue) + ‡∏î‡∏∂‡∏á‡∏õ‡πâ‡∏≤‡∏¢‡∏£‡∏ñ‡∏à‡∏≤‡∏Å Firestore + ‡πÄ‡∏£‡∏¥‡πà‡∏° listener ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏£‡∏ñ‡∏à‡∏≤‡∏Å Realtime Database |
| 129‚Äì144 | `_parseGeoJson(String, Color)` | ‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏ü‡∏•‡πå GeoJSON ‡∏à‡∏≤‡∏Å assets ‚Üí ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô `Polyline` |
| 146‚Äì170 | `_filterRoutes(int)` | ‡∏Å‡∏£‡∏≠‡∏á‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á ‚Äî index 0=‡∏ó‡∏∏‡∏Å‡∏™‡∏≤‡∏¢, 1=Green, 2=Red, 3=Blue, toggle ‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏™‡∏≤‡∏¢ |
| 172‚Äì176 | `_initializeServices()` | ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å `GlobalLocationService.initialize()` + `NotificationService.initialize()` |
| 179‚Äì181 | `dispose()` | ‡∏õ‡∏¥‡∏î map controller |
| 186‚Äì781 | `build()` | ‡∏™‡∏£‡πâ‡∏≤‡∏á UI ‡∏´‡∏•‡∏±‡∏Å ‚Üí **Stack**: `FlutterMap` (‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà), ‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏£‡∏≠‡∏á‡∏™‡∏≤‡∏¢ (Green/Red/Blue), Floating Action Buttons (‡∏Å‡∏•‡∏±‡∏ö‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á/‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏∏‡∏î‡∏´‡∏°‡∏≤‡∏¢/‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô), Proximity Alert Box, TopBar, BottomBar, SideMenu |
| 785‚Äì807 | `_routeButton(...)` | ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏£‡∏≠‡∏á‡∏™‡∏≤‡∏¢‡∏£‡∏ñ (‡∏ß‡∏á‡∏Å‡∏•‡∏°‡∏™‡∏µ) |
| 809‚Äì841 | `_buildTopBar(context)` | AppBar ‡∏ö‡∏ô‡∏™‡∏∏‡∏î ‚Äî ‡πÇ‡∏•‡πÇ‡∏Å‡πâ "LIVE MAP", ‡∏õ‡∏∏‡πà‡∏° Hamburger Menu |
| 843‚Äì865 | `_floatingMapIcon(...)` | ‡∏™‡∏£‡πâ‡∏≤‡∏á Floating Icon ‡∏ö‡∏ô‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà (GPS, Notification, Destination) |
| 867‚Äì945 | `_showDestinationSelectionDialog()` | Dialog ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏∏‡∏î‡∏´‡∏°‡∏≤‡∏¢‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á ‚Äî ‡∏î‡∏∂‡∏á‡∏õ‡πâ‡∏≤‡∏¢‡∏à‡∏≤‡∏Å Firestore ‚Üí `AlertDialog` ‡∏û‡∏£‡πâ‡∏≠‡∏° `ListView` |
| 947‚Äì952 | `_goToMyLocation()` | ‡∏Ç‡∏≠‡∏û‡∏¥‡∏Å‡∏±‡∏î GPS ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ ‚Üí ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏õ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô |
| 954‚Äì956 | `_onNotificationIconTap()` | ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô ‚Üí ‡πÄ‡∏õ‡∏¥‡∏î `_showRouteSelectionDialog()` |
| 958‚Äì1057 | `_showRouteSelectionDialog()` | Dialog ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏≤‡∏¢‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô ‚Äî ‡∏ó‡∏∏‡∏Å‡∏™‡∏≤‡∏¢/‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏™‡∏µ + ‡∏õ‡∏∏‡πà‡∏°‡∏õ‡∏¥‡∏î‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô + ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏∏‡∏î‡∏´‡∏°‡∏≤‡∏¢ |
| 1059‚Äì1086 | `_routeSelectionTile(...)` | ‡∏™‡∏£‡πâ‡∏≤‡∏á ListTile ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏≤‡∏¢‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô |
| 1088‚Äì1096 | `_showNotificationSnackBar(String)` | ‡πÅ‡∏™‡∏î‡∏á SnackBar ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô |
| 1098‚Äì1297 | `_buildProximityAlertBox(service)` | ‡∏Å‡∏•‡πà‡∏≠‡∏á‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏£‡∏ñ‡πÉ‡∏Å‡∏•‡πâ‡∏ñ‡∏∂‡∏á ‚Äî ‡πÅ‡∏™‡∏î‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏ñ, ‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á, ETA countdown, animation ‡∏Å‡∏£‡∏∞‡∏û‡∏£‡∏¥‡∏ö, ‡∏õ‡∏∏‡πà‡∏°‡∏õ‡∏¥‡∏î |
| 1299‚Äì1323 | `_buildBottomBar()` | Navigation Bar ‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á ‚Äî 5 ‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô (Map, BusStop, Route, Plan, Feedback) |
| 1325‚Äì1371 | `_bottomNavItem(index, icon, label)` | ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡πÉ‡∏ô Bottom Navigation |

---

## 4. `busstop-page.dart` (819 ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î)

‡∏´‡∏ô‡πâ‡∏≤‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏õ‡πâ‡∏≤‡∏¢‡∏£‡∏ñ ‚Äî ‡πÅ‡∏™‡∏î‡∏á‡∏õ‡πâ‡∏≤‡∏¢‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏°‡∏™‡∏≤‡∏¢ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏£‡∏ñ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏≠‡∏î‡∏≠‡∏¢‡∏π‡πà

| ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î | ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô/‡∏Ñ‡∏•‡∏≤‡∏™ | ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ |
|--------|--------------|----------|
| 1‚Äì5 | **Imports** + `enum BusLine` | ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤ Firestore, ‡∏Å‡∏≥‡∏´‡∏ô‡∏î enum `BusLine { yellow, red, blue }` |
| 7‚Äì12 | `BusStopPage` (StatefulWidget) | Widget ‡∏´‡∏ô‡πâ‡∏≤‡∏õ‡πâ‡∏≤‡∏¢‡∏£‡∏ñ |
| 14‚Äì818 | `_BusStopPageState` | State ‡∏´‡∏•‡∏±‡∏Å ‚Äî ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£: `_selectedLine`, `_busStopDocs`, `_activeBusStops`, `_realtimeSubscription` |
| 51‚Äì55 | `dispose()` | ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å Realtime Database subscription |
| 58‚Äì83 | `didChangeDependencies()` | ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡πâ‡∏≤‡∏¢‡∏£‡∏ñ‡∏à‡∏≤‡∏Å Firestore + ‡∏ü‡∏±‡∏á Realtime Database ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏£‡∏ñ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô |
| 85‚Äì106 | `_handleRouteIdSwitch(routeData)` | ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏£‡∏ñ‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏µ‡πà‡∏õ‡πâ‡∏≤‡∏¢‡πÑ‡∏´‡∏ô ‚Äî ‡∏´‡∏≤‡∏õ‡πâ‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡πÉ‡∏Å‡∏•‡πâ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡∏à‡∏≤‡∏Å‡∏û‡∏¥‡∏Å‡∏±‡∏î GPS |
| 108‚Äì110 | `_onSelectLine(BusLine)` | ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å (`setState`) |
| 113‚Äì473 | `build()` | UI ‡∏´‡∏•‡∏±‡∏Å ‚Üí TopBar, ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏≤‡∏¢ (‡∏ß‡∏á‡∏Å‡∏•‡∏°‡∏™‡∏µ 3 ‡∏™‡∏µ), `StreamBuilder` ‡∏ü‡∏±‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Firestore/RTDB ‚Üí ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏õ‡πâ‡∏≤‡∏¢‡∏£‡∏ñ |
| 477‚Äì509 | `_buildTopBar(context)` | AppBar "‡∏õ‡πâ‡∏≤‡∏¢‡∏£‡∏ñ" + ‡∏õ‡∏∏‡πà‡∏°‡∏î‡∏π‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏õ‡πâ‡∏≤‡∏¢‡∏£‡∏ñ |
| 511‚Äì553 | `_lineCircle(c, label, sel, tap)` | ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏õ‡∏∏‡πà‡∏°‡∏ß‡∏á‡∏Å‡∏•‡∏°‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏≤‡∏¢ + animation ‡πÄ‡∏°‡∏∑‡πà‡∏≠ selected |
| 555‚Äì683 | `_buildBusStopCard(...)` | ‡∏™‡∏£‡πâ‡∏≤‡∏á Card ‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏õ‡πâ‡∏≤‡∏¢ ‚Äî ‡∏ä‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≤‡∏¢, ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ (‡∏°‡∏µ‡∏£‡∏ñ‡∏à‡∏≠‡∏î/‡πÑ‡∏°‡πà‡∏°‡∏µ), Route Chips, ‡∏õ‡∏∏‡πà‡∏°‡∏î‡∏π‡∏ö‡∏ô‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà |
| 686‚Äì712 | `_buildBottomBar()` | Bottom Navigation Bar |
| 714‚Äì761 | `_bottomNavItem(...)` | ‡πÅ‡∏ï‡πà‡∏•‡∏∞ Item ‡πÉ‡∏ô Bottom Nav |
| 764‚Äì817 | `_buildRouteChips(routesData)` | ‡∏™‡∏£‡πâ‡∏≤‡∏á Chip ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ô‡∏õ‡πâ‡∏≤‡∏¢‡∏ô‡∏µ‡πâ (‡πÄ‡∏ä‡πà‡∏ô "‡∏™‡∏≤‡∏¢ Green", "‡∏™‡∏≤‡∏¢ Red") |

---

## 5. `busstop_map_page.dart` (269 ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î)

‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏™‡∏î‡∏á‡∏õ‡πâ‡∏≤‡∏¢‡∏£‡∏ñ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ‚Äî ‡πÄ‡∏õ‡∏¥‡∏î‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡πâ‡∏≤ BusStop

| ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î | ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô/‡∏Ñ‡∏•‡∏≤‡∏™ | ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ |
|--------|--------------|----------|
| 1‚Äì4 | **Imports** | `flutter_map`, `latlong2`, `cloud_firestore` |
| 6‚Äì11 | `BusStopMapPage` (StatefulWidget) | Widget ‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏õ‡πâ‡∏≤‡∏¢‡∏£‡∏ñ |
| 13‚Äì268 | `_BusStopMapPageState` | State ‡∏´‡∏•‡∏±‡∏Å ‚Äî ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£: `_busStopMarkers`, `_isLoading` |
| 21‚Äì27 | `initState()` | ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å `_fetchBusStops()` |
| 29‚Äì53 | `_fetchBusStops()` | ‡∏î‡∏∂‡∏á‡∏õ‡πâ‡∏≤‡∏¢‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏à‡∏≤‡∏Å Firestore ‚Üí ‡∏™‡∏£‡πâ‡∏≤‡∏á `Marker` ‡∏ó‡∏µ‡πà‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á |
| 56‚Äì76 | `didChangeDependencies()` | ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ `selectedStopId` ‡∏à‡∏≤‡∏Å arguments ‚Üí ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏õ‡∏õ‡πâ‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å |
| 80‚Äì130 | `_buildRouteChips(routesData)` | ‡∏™‡∏£‡πâ‡∏≤‡∏á Chip ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ô‡∏õ‡πâ‡∏≤‡∏¢‡∏ô‡∏±‡πâ‡∏ô |
| 133‚Äì267 | `build()` | UI ‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà ‚Üí `FlutterMap` ‡∏û‡∏£‡πâ‡∏≠‡∏° `TileLayer` (OpenStreetMap) + `MarkerLayer` |

---

## 6. `route-page.dart` (253 ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î)

‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á ‚Äî ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á 3 ‡∏™‡∏≤‡∏¢

| ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î | ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô/‡∏Ñ‡∏•‡∏≤‡∏™ | ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ |
|--------|--------------|----------|
| 1‚Äì2 | **Imports** | `flutter/material`, `sidemenu` |
| 4‚Äì9 | `RoutePage` (StatefulWidget) | Widget ‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á |
| 11‚Äì252 | `_RoutePageState` | State ‚Äî ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£: `_selectedRouteIndex`, `_routeNames`, `_routeColors`, `_routeImages` |
| 34‚Äì116 | `build()` | UI ‚Üí TopBar, ‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏£‡∏≠‡∏á 3 ‡∏™‡∏≤‡∏¢, ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á + SideMenu |
| 119‚Äì138 | `_routeFilterButton(label, color, index)` | ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏£‡∏≠‡∏á‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á |
| 142‚Äì174 | `_buildTopBar(context)` | AppBar "‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á" |
| 176‚Äì200 | `_buildBottomBar()` | Bottom Navigation |
| 202‚Äì251 | `_bottomNavItem(...)` | ‡πÅ‡∏ï‡πà‡∏•‡∏∞ Item |

---

## 7. `plan-page.dart` (1,512 ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î)

‡∏´‡∏ô‡πâ‡∏≤‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á ‚Äî ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡∏à‡∏≤‡∏Å‡∏ï‡πâ‡∏ô‡∏ó‡∏≤‡∏á‚Üí‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á, ‡πÅ‡∏™‡∏î‡∏á‡∏ö‡∏ô‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà

| ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î | ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô/‡∏Ñ‡∏•‡∏≤‡∏™ | ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ |
|--------|--------------|----------|
| 1‚Äì10 | **Imports** | `cloud_firestore`, `flutter_map`, `latlong2`, `route_planner_service` |
| 12‚Äì17 | `PlanPage` (StatefulWidget) | Widget ‡∏´‡∏ô‡πâ‡∏≤‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô |
| 19‚Äì1511 | `_PlanPageState` | State ‡∏´‡∏•‡∏±‡∏Å ‚Äî ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡πÄ‡∏¢‡∏≠‡∏∞: `_mapController`, `_fromStopId`/`_toStopId`, `_routeResults`, `_routePolylines`, `_routeMarkers`, `_allBusStops`, `_detailedRoutes` |
| 51‚Äì54 | `initState()` | ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å `_loadRouteGeoJson()` ‡πÅ‡∏•‡∏∞ `_loadDetailedRoutePlan()` |
| 56‚Äì80 | `_loadRouteGeoJson()` | ‡πÇ‡∏´‡∏•‡∏î GeoJSON 3 ‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á ‚Üí ‡πÄ‡∏Å‡πá‡∏ö‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏ó‡∏∏‡∏Å‡∏à‡∏∏‡∏î ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö draw polyline |
| 82‚Äì118 | `_loadDetailedRoutePlan()` | ‡∏î‡∏∂‡∏á‡∏õ‡πâ‡∏≤‡∏¢‡∏£‡∏ñ‡∏à‡∏≤‡∏Å Firestore ‚Üí ‡∏à‡∏±‡∏ö‡∏Ñ‡∏π‡πà‡∏Å‡∏±‡∏ö internal stop ID ‡∏ú‡πà‡∏≤‡∏ô `RoutePlannerService.mapFirebaseIdToStopId()` |
| 120‚Äì136 | `_parseGeoJsonToPoints(assetPath)` | ‡∏≠‡πà‡∏≤‡∏ô GeoJSON ‚Üí List ‡∏Ç‡∏≠‡∏á `LatLng` |
| 139‚Äì158 | `_findMatchingSegmentPoints(from, to)` | ‡∏´‡∏≤‡∏à‡∏∏‡∏î GeoJSON ‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏ä‡πà‡∏ß‡∏á‡∏õ‡πâ‡∏≤‡∏¢‡∏ï‡πâ‡∏ô‡∏ó‡∏≤‡∏á-‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á |
| 161‚Äì291 | `build()` | UI ‚Üí TopBar, Search Input (from/to dropdown), ‡∏õ‡∏∏‡πà‡∏°‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤, `FlutterMap`, Route Result Cards, SideMenu |
| 294‚Äì354 | `_onSearchBusRoute()` | ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ ‚Üí ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å `RoutePlannerService.findAllRoutes()` ‚Üí `_drawBusRoute()` + `_addRouteMarkers()` |
| 356‚Äì430 | `_drawBusRoute(RouteResult)` | ‡∏ß‡∏≤‡∏î‡πÄ‡∏™‡πâ‡∏ô‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡∏ö‡∏ô‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà ‚Äî ‡∏à‡∏±‡∏ö‡∏Ñ‡∏π‡πà segment ‡∏Å‡∏±‡∏ö GeoJSON coordinates ‚Üí ‡∏™‡∏£‡πâ‡∏≤‡∏á `Polyline` |
| 432‚Äì522 | `_addRouteMarkers()` | ‡πÄ‡∏û‡∏¥‡πà‡∏° Marker ‡∏ö‡∏ô‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà ‚Äî ‡∏õ‡πâ‡∏≤‡∏¢‡∏ï‡πâ‡∏ô‡∏ó‡∏≤‡∏á, ‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á, ‡∏à‡∏∏‡∏î‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏≤‡∏¢ |
| 524‚Äì607 | `_createRouteStopMarker(...)` | ‡∏™‡∏£‡πâ‡∏≤‡∏á Marker ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏õ‡πâ‡∏≤‡∏¢ (‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô + ‡∏ä‡∏∑‡πà‡∏≠ + ‡∏™‡∏µ) |
| 609‚Äì632 | `_getStopCoords(stopId)` | ‡∏î‡∏∂‡∏á‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏à‡∏≤‡∏Å internal data ‡∏´‡∏£‡∏∑‡∏≠ Firestore |
| 634‚Äì674 | `_matchesStopId(name, stopId)` | ‡∏à‡∏±‡∏ö‡∏Ñ‡∏π‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≤‡∏¢‡∏Å‡∏±‡∏ö ID (fuzzy matching) |
| 676‚Äì692 | `_getCoordsFromFirebase(docId)` | ‡∏î‡∏∂‡∏á‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏à‡∏≤‡∏Å Firestore document |
| 695‚Äì765 | `_buildRouteResultCards()` | ‡∏™‡∏£‡πâ‡∏≤‡∏á Card ‡∏ó‡∏∏‡∏Å‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å ‚Äî ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥/‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡πà 2,3... |
| 767‚Äì989 | `_buildSingleRouteCard(result, isRec, idx)` | ‡∏™‡∏£‡πâ‡∏≤‡∏á Card ‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á ‚Äî ‡πÅ‡∏™‡∏î‡∏á‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏õ‡πâ‡∏≤‡∏¢, ‡∏™‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ, timeline, time note |
| 991‚Äì1093 | `_buildRouteTimeline(result)` | ‡∏™‡∏£‡πâ‡∏≤‡∏á Timeline ‡πÅ‡∏ô‡∏ß‡∏ï‡∏±‡πâ‡∏á ‚Äî ‡πÅ‡∏™‡∏î‡∏á node ‡∏ï‡πâ‡∏ô‡∏ó‡∏≤‡∏á ‚Üí ‡∏à‡∏∏‡∏î‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô ‚Üí ‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á |
| 1095‚Äì1170 | `_buildTimelineNode(...)` | ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞ Node ‡πÉ‡∏ô timeline (‡∏ß‡∏á‡∏Å‡∏•‡∏°‡∏™‡∏µ + ‡∏ä‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≤‡∏¢) |
| 1172‚Äì1220 | `_buildTimelineLine(...)` | ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏™‡πâ‡∏ô‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡πÉ‡∏ô timeline (‡∏™‡∏µ‡∏Ç‡∏≠‡∏á‡∏™‡∏≤‡∏¢ + ‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏¢ + ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏õ‡πâ‡∏≤‡∏¢) |
| 1223‚Äì1267 | `_buildDropdown(...)` | ‡∏™‡∏£‡πâ‡∏≤‡∏á Dropdown ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡πâ‡∏≤‡∏¢‡∏ï‡πâ‡∏ô‡∏ó‡∏≤‡∏á/‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á |
| 1269‚Äì1300 | `_buildTopBar()` | AppBar "‡πÅ‡∏û‡∏•‡∏ô" |
| 1302‚Äì1374 | `_buildBottomBar()` + `_bottomNavItem()` | Bottom Navigation |
| 1378‚Äì1447 | `_buildFullSearchInput()` | ‡∏™‡πà‡∏ß‡∏ô UI ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡πâ‡∏ô‡∏ó‡∏≤‡∏á-‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á ‡πÅ‡∏ö‡∏ö‡πÄ‡∏ï‡πá‡∏° (2 dropdown + ‡∏õ‡∏∏‡πà‡∏°‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ + ‡∏õ‡∏∏‡πà‡∏°‡∏™‡∏•‡∏±‡∏ö) |
| 1449‚Äì1510 | `_buildCompactSearchHeader()` | ‡∏™‡πà‡∏ß‡∏ô UI ‡∏¢‡πà‡∏≠ ‚Äî ‡πÇ‡∏ä‡∏ß‡πå "A ‚Üí B" ‡∏Å‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç |

---

## 8. `feedback-page.dart` (356 ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î)

‡∏´‡∏ô‡πâ‡∏≤‡∏™‡πà‡∏á Feedback ‚Äî ‡∏£‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô + ‡πÉ‡∏´‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô

| ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î | ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô/‡∏Ñ‡∏•‡∏≤‡∏™ | ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ |
|--------|--------------|----------|
| 1‚Äì5 | **Imports** + `enum FeedbackMode` | `{ complain, rating }` |
| 7‚Äì12 | `FeedbackPage` (StatefulWidget) | Widget ‡∏´‡∏ô‡πâ‡∏≤ Feedback |
| 14‚Äì355 | `_FeedbackPageState` | State ‚Äî ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£: `_mode`, `_messageController`, `_rating` |
| 25‚Äì28 | `dispose()` | ‡∏õ‡∏¥‡∏î `_messageController` |
| 31‚Äì185 | `build()` | UI ‚Üí TopBar, ‡∏õ‡∏∏‡πà‡∏°‡∏™‡∏•‡∏±‡∏ö Complain/Rating, TextArea ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°, Star Rating (‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô rating mode), ‡∏õ‡∏∏‡πà‡∏°‡∏™‡πà‡∏á |
| 187‚Äì230 | `_onSubmit()` | ‡∏™‡πà‡∏á Feedback ‡πÑ‡∏õ Firestore collection `'feedback'` ‚Äî ‡πÄ‡∏Å‡πá‡∏ö type, message, rating, timestamp |
| 232‚Äì263 | `_buildTopBar()` | AppBar "Feedback" |
| 265‚Äì278 | `_modeButton(label, isSelected, onTap)` | ‡∏õ‡∏∏‡πà‡∏°‡∏™‡∏•‡∏±‡∏ö‡πÇ‡∏´‡∏°‡∏î Complain/Rating |
| 281‚Äì354 | `_buildBottomBar()` + `_bottomNavItem()` | Bottom Navigation |

---

## 9. `sidemenu.dart` (186 ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î)

‡πÄ‡∏°‡∏ô‡∏π‡∏î‡πâ‡∏≤‡∏ô‡∏Ç‡πâ‡∏≤‡∏á (Drawer) ‚Äî ‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏≤‡∏°‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ

| ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î | ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô/‡∏Ñ‡∏•‡∏≤‡∏™ | ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ |
|--------|--------------|----------|
| 1‚Äì6 | **Imports** | `firebase_auth`, `shared_preferences`, `change_route_page`, `manager_page` |
| 8‚Äì13 | `SideMenu` (StatefulWidget) | Widget ‡πÄ‡∏°‡∏ô‡∏π |
| 15‚Äì185 | `_SideMenuState` | State ‚Äî ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠ `driverEmails` ‡πÅ‡∏•‡∏∞ `managerEmails` |
| 26‚Äì184 | `build()` | ‡∏™‡∏£‡πâ‡∏≤‡∏á `Drawer` ‚Üí Header (‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå + email), ‡πÄ‡∏°‡∏ô‡∏π‡∏ï‡∏≤‡∏°‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó: ‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ ‚Üí "‡∏´‡∏ô‡πâ‡∏≤‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£", ‡∏Ñ‡∏ô‡∏Ç‡∏±‡∏ö ‚Üí "‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏ô‡∏£‡∏ñ", ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ login ‚Üí "‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö", ‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡πÅ‡∏•‡πâ‡∏ß ‚Üí "Logout" (‡∏•‡πâ‡∏≤‡∏á SharedPreferences + signOut) |

---

## 10. `change_route_page.dart` (624 ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î)

‡∏´‡∏ô‡πâ‡∏≤‡∏Ñ‡∏ô‡∏Ç‡∏±‡∏ö‡∏£‡∏ñ ‚Äî ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏£‡∏ñ + ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏≤‡∏¢

| ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î | ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô/‡∏Ñ‡∏•‡∏≤‡∏™ | ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ |
|--------|--------------|----------|
| 1‚Äì4 | **Imports** | `firebase_database`, `shared_preferences` |
| 6‚Äì11 | `ChangeRoutePage` (StatefulWidget) | Widget ‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏ô‡∏£‡∏ñ |
| 13‚Äì623 | `_ChangeRoutePageState` | State ‚Äî ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£: `_selectedRoute`, `_selectedBus`, `_driverName`, `_busStatusMap`, `_myActiveBus` |
| 45‚Äì52 | `initState()` | ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å `_checkSavedDriverName()` + `_listenToBusStatusRealtime()` |
| 55‚Äì69 | `_checkSavedDriverName()` | ‡∏î‡∏∂‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏ô‡∏Ç‡∏±‡∏ö‡∏à‡∏≤‡∏Å `SharedPreferences` ‚Äî ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ ‡πÅ‡∏™‡∏î‡∏á Dialog ‡πÉ‡∏´‡πâ‡∏Å‡∏£‡∏≠‡∏Å |
| 72‚Äì142 | `_showDriverNameDialog()` | Dialog ‡πÉ‡∏´‡πâ‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠ ‚Üí ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á SharedPreferences |
| 144‚Äì214 | `_listenToBusStatusRealtime()` | ‡∏ü‡∏±‡∏á Realtime Database path `'GPS'` ‚Üí ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏£‡∏ñ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏±‡∏ô (‡∏ß‡πà‡∏≤‡∏á‡∏´‡∏£‡∏∑‡∏≠‡∏°‡∏µ‡∏Ñ‡∏ô‡∏Ç‡∏±‡∏ö) |
| 217‚Äì286 | `_submitData()` | ‡∏à‡∏≠‡∏á‡∏£‡∏ñ ‚Üí ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• `driverName`, `routeColor` ‡πÑ‡∏õ Realtime Database path `GPS/{busId}` |
| 289‚Äì357 | `_releaseBus()` | ‡∏õ‡∏•‡πà‡∏≠‡∏¢‡∏£‡∏ñ ‚Üí ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• `driverName`, `routeColor` ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å RTDB |
| 359‚Äì365 | `_getRouteName(colorValue)` | ‡πÅ‡∏õ‡∏•‡∏á color id ‚Üí ‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏¢ ("Green" ‚Üí "‡∏™‡∏≤‡∏¢‡∏´‡∏ô‡πâ‡∏≤‡∏°‡∏≠") |
| 367‚Äì369 | `_formatBusName(busId)` | ‡πÅ‡∏õ‡∏•‡∏á "bus_1" ‚Üí "‡∏£‡∏ñ‡πÄ‡∏ö‡∏≠‡∏£‡πå 1" |
| 372‚Äì622 | `build()` | UI ‚Üí AppBar, ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô (‡∏ñ‡πâ‡∏≤‡∏Ç‡∏±‡∏ö‡∏≠‡∏¢‡∏π‡πà), Dropdown ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏≤‡∏¢, Dropdown ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏ñ (‡πÅ‡∏™‡∏î‡∏á available/‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏á), ‡∏õ‡∏∏‡πà‡∏°‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô, ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏£‡∏ñ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ |

---

## 11. `manager_page.dart` (1,007 ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î)

‡∏´‡∏ô‡πâ‡∏≤‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ ‚Äî 2 Tab: Feedback Report + Driver Report

| ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î | ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô/‡∏Ñ‡∏•‡∏≤‡∏™ | ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ |
|--------|--------------|----------|
| 1‚Äì5 | **Imports** | `firebase_auth`, `cloud_firestore`, `firebase_database` |
| 7‚Äì12 | `ManagerPage` (StatefulWidget) | Widget ‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ |
| 14‚Äì1006 | `_ManagerPageState` | State ‚Äî ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£: `_tabController`, `_feedbackFilter`, `_feedbackRouteFilter` |
| 27‚Äì30 | `initState()` | ‡∏™‡∏£‡πâ‡∏≤‡∏á `TabController(length: 2)` |
| 33‚Äì36 | `dispose()` | ‡∏õ‡∏¥‡∏î TabController |
| 38‚Äì43 | `_handleLogout()` | ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö + ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å |
| 46‚Äì75 | `build()` | UI ‚Üí AppBar ‡∏û‡∏£‡πâ‡∏≠‡∏° TabBar (üìù Feedback / üöå ‡∏Ñ‡∏ô‡∏Ç‡∏±‡∏ö), TabBarView |
| 77‚Äì299 | `_buildFeedbackTab()` | **Tab 1** ‚Äî ‡∏î‡∏∂‡∏á Feedback ‡∏à‡∏≤‡∏Å Firestore ‚Üí Filter (‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î/‡∏£‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô/‡πÉ‡∏´‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô) + Filter ‡∏ï‡∏≤‡∏°‡∏™‡∏≤‡∏¢ ‚Üí ‡πÅ‡∏™‡∏î‡∏á Card ‡πÅ‡∏ï‡πà‡∏•‡∏∞ feedback ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏î‡∏≤‡∏ß rating |
| 301‚Äì628 | `_buildDriverTab()` | **Tab 2** ‚Äî ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏ñ‡∏à‡∏≤‡∏Å Realtime Database path `'GPS'` ‚Üí ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡∏ô‡∏Ç‡∏±‡∏ö ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ active/offline, ‡∏™‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡∏ß‡∏¥‡πà‡∏á, ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏£‡∏ñ |
| 630‚Äì658 | `_filterChip(...)` | ‡∏™‡∏£‡πâ‡∏≤‡∏á FilterChip ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏£‡∏≠‡∏á Feedback |
| 660‚Äì695 | `_routeFilterChip(...)` | ‡∏™‡∏£‡πâ‡∏≤‡∏á FilterChip ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏£‡∏≠‡∏á‡∏ï‡∏≤‡∏°‡∏™‡∏≤‡∏¢ |
| 697‚Äì818 | `_showFeedbackDetail(...)` | Dialog ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î Feedback |
| 820‚Äì988 | `_showDriverDetail(...)` | Dialog ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Ñ‡∏ô‡∏Ç‡∏±‡∏ö |
| 990‚Äì1005 | `_infoRow(icon, label, value)` | Helper ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ñ‡∏ß‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• |

---

## 12. `models/bus_model.dart` (111 ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î)

Model ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏ñ‡∏ö‡∏±‡∏™ + ‡∏™‡∏≤‡∏¢‡∏£‡∏ñ

| ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î | ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô/‡∏Ñ‡∏•‡∏≤‡∏™ | ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ |
|--------|--------------|----------|
| 3‚Äì63 | `class Bus` | Model ‡∏£‡∏ñ‡∏ö‡∏±‡∏™ ‚Äî Fields: `id`, `position` (LatLng), `name`, `routeId`, `distanceToUser`, `driverName`, `routeColor` |
| 25‚Äì51 | `Bus.fromFirebase(id, data)` | Factory ‚Äî ‡πÅ‡∏õ‡∏•‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Realtime DB ‚Üí `Bus` object, ‡∏°‡∏µ logic ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ nested data |
| 52‚Äì62 | `Bus.copyWithDistance(dist)` | ‡∏™‡∏£‡πâ‡∏≤‡∏á Bus ‡πÉ‡∏´‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏° distance ‡∏ó‡∏µ‡πà‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÅ‡∏•‡πâ‡∏ß |
| 66‚Äì110 | `class BusRoute` | Model ‡∏™‡∏≤‡∏¢‡∏£‡∏ñ ‚Äî Fields: `id`, `name`, `shortName`, `colorValue` |
| 79‚Äì100 | `BusRoute.allRoutes` (static) | ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏≤‡∏¢ 3 ‡∏™‡∏≤‡∏¢: Green (‡∏™‡∏≤‡∏¢‡∏´‡∏ô‡πâ‡∏≤‡∏°‡∏≠), Red (‡∏™‡∏≤‡∏¢‡∏´‡∏≠‡∏û‡∏±‡∏Å), Blue (‡∏™‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏ï‡∏π‡∏á‡∏≤‡∏°) |
| 101‚Äì109 | `BusRoute.fromId(id)` (static) | ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡∏≤‡∏¢‡∏à‡∏≤‡∏Å ID |

---

## 13. `models/bus_route_data.dart` (297 ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î)

‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡πâ‡∏≤‡∏¢‡∏£‡∏ñ‡πÅ‡∏•‡∏∞‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á (Hard-coded)

| ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î | ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô/‡∏Ñ‡∏•‡∏≤‡∏™ | ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ |
|--------|--------------|----------|
| 2‚Äì20 | `class BusStopData` | Model ‡∏õ‡πâ‡∏≤‡∏¢‡∏£‡∏ñ ‚Äî Fields: `id`, `name`, `aliases` (‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏∑‡πà‡∏ô) |
| 23‚Äì78 | `class BusRouteData` | Model ‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á ‚Äî Fields: `id`, `name`, `color`, `colorValue`, `stops` (‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏õ‡πâ‡∏≤‡∏¢), `startHour`/`endHour` (‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏´‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£) |
| 42‚Äì55 | `isActiveAt(DateTime)` | ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏™‡∏≤‡∏¢‡∏ô‡∏µ‡πâ‡∏ß‡∏¥‡πà‡∏á‡πÉ‡∏ô‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÑ‡∏´‡∏° |
| 57‚Äì60 | `indexOfStop(stopId)` | ‡∏´‡∏≤ index ‡∏Ç‡∏≠‡∏á‡∏õ‡πâ‡∏≤‡∏¢‡πÉ‡∏ô‡∏™‡∏≤‡∏¢ |
| 62‚Äì65 | `lastIndexOfStop(stopId)` | ‡∏´‡∏≤ index ‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡∏õ‡πâ‡∏≤‡∏¢ |
| 67‚Äì74 | `allIndicesOfStop(stopId)` | ‡∏´‡∏≤‡∏ó‡∏∏‡∏Å index ‡∏Ç‡∏≠‡∏á‡∏õ‡πâ‡∏≤‡∏¢ (‡∏õ‡πâ‡∏≤‡∏¢‡∏≠‡∏≤‡∏à‡∏õ‡∏£‡∏≤‡∏Å‡∏è‡∏´‡∏•‡∏≤‡∏¢‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ö‡∏ô‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡∏ß‡∏ô) |
| 76‚Äì77 | `hasStop(stopId)` | ‡∏ï‡∏£‡∏ß‡∏à‡∏ß‡πà‡∏≤‡∏õ‡πâ‡∏≤‡∏¢‡∏°‡∏µ‡πÉ‡∏ô‡∏™‡∏≤‡∏¢‡πÑ‡∏´‡∏° |
| 81‚Äì195 | `class BusStops` | ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡πâ‡∏≤‡∏¢‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö (static `all`) ‚Äî ‡∏õ‡πâ‡∏≤‡∏¢‡πÄ‡∏ä‡πà‡∏ô PKY, CE, AGRI, SCI ‡∏Ø‡∏•‡∏Ø |
| 172‚Äì179 | `BusStops.fromId(id)` | ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏õ‡πâ‡∏≤‡∏¢‡∏à‡∏≤‡∏Å ID |
| 181‚Äì194 | `BusStops.fromName(name)` | ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏õ‡πâ‡∏≤‡∏¢‡∏à‡∏≤‡∏Å‡∏ä‡∏∑‡πà‡∏≠ (fuzzy match, ‡∏Ñ‡πâ‡∏ô‡∏à‡∏≤‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏•‡∏±‡∏Å‡πÅ‡∏•‡∏∞ aliases) |
| 198‚Äì296 | `class BusRoutes` | ‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡∏ó‡∏±‡πâ‡∏á 3 ‡∏™‡∏≤‡∏¢ (static `all`) ‚Äî ‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏™‡∏≤‡∏¢‡∏°‡∏µ‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏õ‡πâ‡∏≤‡∏¢, ‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏´‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£ |
| 286‚Äì289 | `BusRoutes.getActiveRoutes(time)` | ‡∏´‡∏≤‡∏™‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡∏ß‡∏¥‡πà‡∏á‡πÉ‡∏ô‡πÄ‡∏ß‡∏•‡∏≤‡∏ô‡∏±‡πâ‡∏ô |
| 291‚Äì295 | `BusRoutes.getRoutesWithStop(stopId)` | ‡∏´‡∏≤‡∏™‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ô‡∏õ‡πâ‡∏≤‡∏¢‡∏ô‡∏µ‡πâ |

---

## 14. `services/global_location_service.dart` (426 ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î)

Service ‡∏´‡∏•‡∏±‡∏Å ‚Äî ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏° GPS ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ + ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏£‡∏ñ + ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏£‡∏ñ‡πÉ‡∏Å‡∏•‡πâ‡∏ñ‡∏∂‡∏á

| ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î | ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô/‡∏Ñ‡∏•‡∏≤‡∏™ | ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ |
|--------|--------------|----------|
| 1‚Äì12 | **Imports** | `geolocator`, `latlong2`, `firebase_database`, `notification_service`, `bus_model` |
| 13‚Äì425 | `class GlobalLocationService extends ChangeNotifier` | Service ‚Äî ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç: `_userPosition`, `_isNotifyEnabled`, `_notifyRouteId`, `_destinationName`, `_closestBus`, `_alertStage`, `_busStops`, `_busList` |
| 55‚Äì68 | `initialize()` | ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô ‚Äî ‡∏Ç‡∏≠ permission GPS ‚Üí `_fetchBusStops()` ‚Üí `_listenToBusLocation()` ‚Üí `_startLocationTracking()` |
| 70‚Äì79 | `setNotifyEnabled(bool, routeId)` | ‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô + ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏™‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ |
| 81‚Äì103 | `setDestination(name, routeId)` | ‡∏ï‡∏±‡πâ‡∏á‡∏à‡∏∏‡∏î‡∏´‡∏°‡∏≤‡∏¢ ‚Äî ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏à‡∏≤‡∏Å `_busStops` + filter ‡∏™‡∏≤‡∏¢‡∏ó‡∏µ‡πà notify |
| 118‚Äì142 | `_fetchBusStops()` | ‡∏î‡∏∂‡∏á‡∏õ‡πâ‡∏≤‡∏¢‡∏£‡∏ñ‡∏à‡∏≤‡∏Å Firestore collection `'busstop'` |
| 144‚Äì177 | `_listenToBusLocation()` | ‡∏ü‡∏±‡∏á RTDB path `'GPS'` ‚Üí ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô `Bus` objects ‚Üí ‡∏Å‡∏£‡∏≠‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏£‡∏ñ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ñ‡∏ô‡∏Ç‡∏±‡∏ö ‚Üí ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å `_updateClosestBus()` |
| 179‚Äì219 | `_startLocationTracking()` | ‡πÄ‡∏£‡∏¥‡πà‡∏° `Geolocator.getPositionStream()` ‚Üí ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï `_userPosition` ‚Üí ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å `_updateClosestBus()` |
| 221‚Äì359 | `_updateClosestBus()` | **Logic ‡∏´‡∏•‡∏±‡∏Å** ‚Äî ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏ñ‡∏ó‡∏µ‡πà‡πÉ‡∏Å‡∏•‡πâ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î, ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì ETA, ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö alert stage (5‡∏ô‡∏≤‡∏ó‡∏µ/3‡∏ô‡∏≤‡∏ó‡∏µ/1‡∏ô‡∏≤‡∏ó‡∏µ/‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ) ‚Üí ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å `_triggerAlert()` ‡∏ñ‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡πÄ‡∏Å‡∏ì‡∏ë‡πå |
| 361‚Äì375 | `_triggerAlert(bus, dist, eta, msg)` | ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô ‚Üí ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å `NotificationService.alertBusNearby()` |
| 377‚Äì397 | `getClosestStopInfo()` | ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏õ‡πâ‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡πÉ‡∏Å‡∏•‡πâ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î (‡∏ä‡∏∑‡πà‡∏≠ + ‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á) |
| 399‚Äì417 | `findClosestStop()` | ‡∏Ñ‡∏∑‡∏ô Map ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡πâ‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡πÉ‡∏Å‡∏•‡πâ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î |
| 419‚Äì424 | `dispose()` | ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å subscription ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î |

---

## 15. `services/notification_service.dart` (118 ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î)

‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Push Notification + ‡∏™‡∏±‡πà‡∏ô‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô

| ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î | ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô/‡∏Ñ‡∏•‡∏≤‡∏™ | ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ |
|--------|--------------|----------|
| 5‚Äì117 | `class NotificationService` | Static class ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î |
| 11‚Äì31 | `initialize()` | ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ `FlutterLocalNotificationsPlugin` (Android + iOS) |
| 33‚Äì41 | `calculateEtaSeconds(dist, speed)` | ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì ETA ‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á √∑ ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß (‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô 35 km/h) |
| 43‚Äì54 | `formatEta(etaSeconds)` | ‡πÅ‡∏õ‡∏•‡∏á seconds ‚Üí "X ‡∏ô‡∏≤‡∏ó‡∏µ Y ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ" ‡∏´‡∏£‡∏∑‡∏≠ "‡∏ñ‡∏∂‡∏á‡πÅ‡∏•‡πâ‡∏ß" |
| 56‚Äì92 | `showBusNearbyNotification(...)` | ‡πÅ‡∏™‡∏î‡∏á Push Notification ‚Äî channel "Bus Proximity Alerts" |
| 94‚Äì100 | `vibrate()` | ‡∏™‡∏±‡πà‡∏ô‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô 1 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ |
| 102‚Äì116 | `alertBusNearby(...)` | ‡∏£‡∏ß‡∏° notification + vibrate ‡πÄ‡∏Ç‡πâ‡∏≤‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏±‡∏ô (`Future.wait`) |

---

## 16. `services/route_planner_service.dart` (641 ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î)

‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á ‚Äî ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö Direct + Transfer (‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏≤‡∏¢)

| ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î | ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô/‡∏Ñ‡∏•‡∏≤‡∏™ | ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ |
|--------|--------------|----------|
| 5‚Äì27 | `class RouteResult` | ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á ‚Äî Fields: `segments`, `totalStops`, `isTransfer`, `message`, `timeNote`, `isDirect` |
| 30‚Äì47 | `class RouteSegment` | ‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á ‚Äî Fields: `routeId`, `routeName`, `fromStop`, `toStop`, `stopCount`, `color`, `intermediateStops` |
| 50‚Äì640 | `class RoutePlannerService` | Service ‡∏´‡∏•‡∏±‡∏Å |
| 51‚Äì66 | `findRoute(from, to, time)` | ‡∏´‡∏≤‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î ‚Üí ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å `findAllRoutes()` ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏±‡∏ß‡πÅ‡∏£‡∏Å |
| 68‚Äì179 | `findAllRoutes(from, to, time)` | ‡∏´‡∏≤‡∏ó‡∏∏‡∏Å‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á ‚Üí `_findAllDirectRoutes()` + `_findAllTransferRoutes()` ‚Üí ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏° score ‚Üí ‡∏Å‡∏≥‡∏à‡∏±‡∏î duplicate |
| 181‚Äì198 | `_calculateWeightedScore(result)` | ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏õ‡πâ‡∏≤‡∏¢ + penalty ‡∏ß‡∏ô‡∏£‡∏ñ + penalty ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏≤‡∏¢ |
| 200‚Äì221 | `_getTimeNoteForRoute(route, result)` | ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡πÄ‡∏ß‡∏•‡∏≤ (‡πÄ‡∏ä‡πà‡∏ô "‡∏™‡∏≤‡∏¢‡∏ô‡∏µ‡πâ‡∏ß‡∏¥‡πà‡∏á 6:00-18:00") |
| 223‚Äì254 | `_getTimeNoteForTransfer(result)` | ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏≤‡∏¢ |
| 256‚Äì263 | `_isCircular(route)` | ‡∏ï‡∏£‡∏ß‡∏à‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô circular route (‡∏õ‡πâ‡∏≤‡∏¢‡πÅ‡∏£‡∏Å = ‡∏õ‡πâ‡∏≤‡∏¢‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢) |
| 265‚Äì278 | `_calculateStopCount(from, to, total, isCirc)` | ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏õ‡πâ‡∏≤‡∏¢‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á 2 index |
| 280‚Äì301 | `_getStopsInBetween(route, from, to, isCirc)` | ‡∏î‡∏∂‡∏á list ‡∏õ‡πâ‡∏≤‡∏¢‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏ó‡∏≤‡∏á |
| 303‚Äì320 | `_generateMessageFromSegments(segments)` | ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ ("‡∏Ç‡∏∂‡πâ‡∏ô‡∏™‡∏≤‡∏¢ X ‡∏ó‡∏µ‡πà A ‚Üí ‡∏•‡∏á‡∏ó‡∏µ‡πà B") |
| 322‚Äì367 | `_splitIfPassingTerminal(segments)` | ‡πÅ‡∏ö‡πà‡∏á segment ‡∏ñ‡πâ‡∏≤‡∏ú‡πà‡∏≤‡∏ô PKY (‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏ñ) |
| 369‚Äì421 | `_findAllDirectRoutes(from, to, routes)` | ‡∏´‡∏≤‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡∏ï‡∏£‡∏á ‚Äî ‡∏ï‡∏£‡∏ß‡∏à‡∏ó‡∏∏‡∏Å‡∏™‡∏≤‡∏¢‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏ó‡∏±‡πâ‡∏á from ‡πÅ‡∏•‡∏∞ to ‡πÑ‡∏´‡∏°, ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö circular route |
| 423‚Äì571 | `_findAllTransferRoutes(from, to, routes)` | ‡∏´‡∏≤‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏≤‡∏¢ ‚Äî ‡∏´‡∏≤‡∏à‡∏∏‡∏î‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô + ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì stopCount ‡∏ó‡∏±‡πâ‡∏á 2 ‡∏ä‡πà‡∏ß‡∏á |
| 573‚Äì581 | `_findTransferPoints(route1, route2)` | ‡∏´‡∏≤‡∏õ‡πâ‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏ó‡∏±‡πâ‡∏á 2 ‡∏™‡∏≤‡∏¢ |
| 583‚Äì639 | `mapFirebaseIdToStopId(fbId, name)` | ‡πÅ‡∏õ‡∏•‡∏á Firebase Document ID ‚Üí internal stop ID |

---

## 17. `services/route_service.dart` (71 ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î)

‡πÄ‡∏£‡∏µ‡∏¢‡∏Å OpenRouteService API ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á‡∏ñ‡∏ô‡∏ô‡∏à‡∏£‡∏¥‡∏á

| ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î | ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô/‡∏Ñ‡∏•‡∏≤‡∏™ | ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ |
|--------|--------------|----------|
| 6‚Äì63 | `class RouteService` | Static class ‚Äî API Key + Base URL |
| 16‚Äì57 | `getRoadDistance(from, to)` | ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á ‚Äî ‡πÄ‡∏ä‡πá‡∏Ñ cache ‡∏Å‡πà‡∏≠‡∏ô ‚Üí ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å API ‚Üí cache ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå (30 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ) |
| 59‚Äì62 | `clearCache()` | ‡∏•‡πâ‡∏≤‡∏á cache |
| 65‚Äì70 | `class _CachedDistance` | ‡πÄ‡∏Å‡πá‡∏ö distance + timestamp |

---

## 18. `widgets/global_debug_bar.dart` (15 ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î)

Wrapper Widget (‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß)

| ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î | ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô/‡∏Ñ‡∏•‡∏≤‡∏™ | ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ |
|--------|--------------|----------|
| 4‚Äì14 | `GlobalDebugBarWrapper` (StatelessWidget) | ‡∏£‡∏±‡∏ö `child` ‚Üí return `child` ‡∏ï‡∏£‡∏á‡πÜ (‡πÑ‡∏°‡πà‡∏°‡∏µ debug bar ‡πÅ‡∏•‡πâ‡∏ß) |

---

## Dependencies ‡∏´‡∏•‡∏±‡∏Å (‡∏à‡∏≤‡∏Å `pubspec.yaml`)

| Package | ‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô | ‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö |
|---------|---------|----------|
| `firebase_core` | ^4.4.0 | ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô Firebase |
| `cloud_firestore` | ^6.1.0 | ‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Firestore (‡∏õ‡πâ‡∏≤‡∏¢‡∏£‡∏ñ, Feedback) |
| `firebase_database` | ^12.1.1 | Realtime Database (‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á GPS ‡∏£‡∏ñ) |
| `firebase_auth` | ^6.1.4 | ‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô (Email/Password) |
| `flutter_map` | ^8.2.2 | ‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà (OpenStreetMap) |
| `latlong2` | ^0.9.1 | ‡∏Ñ‡∏•‡∏≤‡∏™‡∏û‡∏¥‡∏Å‡∏±‡∏î LatLng |
| `geolocator` | ^14.0.2 | ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏° GPS ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ |
| `flutter_local_notifications` | ^18.0.1 | Push Notification |
| `vibration` | ^2.0.1 | ‡∏™‡∏±‡πà‡∏ô‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô |
| `provider` | ^6.1.5+1 | State Management |
| `shared_preferences` | ^2.2.2 | ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• local |
| `http` | ^1.2.0 | ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å API |
| `flutter_map_animations` | 0.9.0 | Animation ‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà |

---

## üìê ‡∏™‡∏π‡∏ï‡∏£‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå (‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡πÅ‡∏ö‡∏ö‡∏†‡∏≤‡∏©‡∏≤‡∏Ñ‡∏ô)

### 1. ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏ß‡∏•‡∏≤‡∏ñ‡∏∂‡∏á‡πÇ‡∏î‡∏¢‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì (ETA)

> üìÅ ‡πÑ‡∏ü‡∏•‡πå: [notification_service.dart](file:///z:/daft_ani-main/lib/services/notification_service.dart#L35-L41)
> üìç ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ó‡∏µ‡πà **35‚Äì41** (‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô `calculateEtaSeconds`)

**‡∏û‡∏π‡∏î‡∏á‡πà‡∏≤‡∏¢‡πÜ:** ‡πÄ‡∏£‡∏≤‡∏≠‡∏¢‡∏≤‡∏Å‡∏£‡∏π‡πâ‡∏ß‡πà‡∏≤ "‡∏£‡∏ñ‡∏à‡∏∞‡∏°‡∏≤‡∏ñ‡∏∂‡∏á‡∏≠‡∏µ‡∏Å‡∏Å‡∏µ‡πà‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ" ‡∏Å‡πá‡πÄ‡∏≠‡∏≤ **‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á ‡∏´‡∏≤‡∏£‡∏î‡πâ‡∏ß‡∏¢ ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß** ‡πÄ‡∏•‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö ‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏π‡∏ï‡∏£‡∏ü‡∏¥‡∏™‡∏¥‡∏Å‡∏™‡πå ‡∏°.‡∏ï‡πâ‡∏ô‡πÄ‡∏•‡∏¢ ‡∏Ñ‡∏∑‡∏≠ **‡πÄ‡∏ß‡∏•‡∏≤ = ‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á √∑ ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß**

- ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÉ‡∏´‡πâ‡∏£‡∏ñ‡∏ö‡∏±‡∏™‡∏ß‡∏¥‡πà‡∏á‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢ **35 ‡∏Å‡∏°./‡∏ä‡∏°.**
- ‡πÅ‡∏ï‡πà‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á‡πÄ‡∏£‡∏≤‡πÄ‡∏õ‡πá‡∏ô**‡πÄ‡∏°‡∏ï‡∏£** ‡∏î‡∏±‡∏á‡∏ô‡∏±‡πâ‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏õ‡∏•‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡πÄ‡∏õ‡πá‡∏ô **‡πÄ‡∏°‡∏ï‡∏£/‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ** ‡∏Å‡πà‡∏≠‡∏ô
- ‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏õ‡∏•‡∏á (‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î **39**): ‡πÄ‡∏≠‡∏≤ 35 ‡∏Ñ‡∏π‡∏ì 1000 (‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏°‡∏ï‡∏£) ‡πÅ‡∏•‡πâ‡∏ß‡∏´‡∏≤‡∏£‡∏î‡πâ‡∏ß‡∏¢ 3600 (‡πÄ‡∏õ‡πá‡∏ô‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ) = ‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì **9.72 ‡∏°./‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ**
- ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì ETA (‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î **40**): ‡πÄ‡∏≠‡∏≤‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á‡∏´‡∏≤‡∏£‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡πÅ‡∏•‡πâ‡∏ß‡∏õ‡∏±‡∏î‡πÄ‡∏®‡∏©

**‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á:** ‡∏ñ‡πâ‡∏≤‡∏£‡∏ñ‡∏≠‡∏¢‡∏π‡πà‡∏´‡πà‡∏≤‡∏á 500 ‡πÄ‡∏°‡∏ï‡∏£ ‚Üí 500 √∑ 9.72 = ‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì **51 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ** ‡∏Ñ‡∏∑‡∏≠‡∏£‡∏ñ‡∏à‡∏∞‡∏°‡∏≤‡∏ñ‡∏∂‡∏á‡πÉ‡∏ô 51 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ‡∏Ñ‡∏£‡∏±‡∏ö

---

### 2. ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á (2 ‡∏ß‡∏¥‡∏ò‡∏µ)

#### ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà 1: Haversine ‚Äî ‡∏´‡∏≤‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á "‡πÄ‡∏™‡πâ‡∏ô‡∏ï‡∏£‡∏á" ‡∏ö‡∏ô‡πÇ‡∏•‡∏Å‡∏Å‡∏•‡∏°

> üìÅ ‡πÑ‡∏ü‡∏•‡πå: [global_location_service.dart](file:///z:/daft_ani-main/lib/services/global_location_service.dart#L225-L237)
> üìç ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ó‡∏µ‡πà **225** (‡∏™‡∏£‡πâ‡∏≤‡∏á Distance object) ‡πÅ‡∏•‡∏∞ **233‚Äì235** (‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏à‡∏£‡∏¥‡∏á)

**‡∏û‡∏π‡∏î‡∏á‡πà‡∏≤‡∏¢‡πÜ:** ‡πÄ‡∏£‡∏≤‡πÉ‡∏ä‡πâ library `latlong2` ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ñ‡∏•‡∏≤‡∏™ `Distance()` ‡∏ä‡πà‡∏ß‡∏¢‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÉ‡∏´‡πâ ‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏´‡∏•‡∏±‡∏á‡∏°‡∏±‡∏ô‡πÉ‡∏ä‡πâ‡∏™‡∏π‡∏ï‡∏£‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ß‡πà‡∏≤ **Haversine** ‡∏ã‡∏∂‡πà‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏π‡∏ï‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á 2 ‡∏à‡∏∏‡∏î‡∏ö‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ú‡∏¥‡∏ß‡πÇ‡∏•‡∏Å‡∏Ñ‡∏£‡∏±‡∏ö

- ‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤ **‡∏•‡∏∞‡∏ï‡∏¥‡∏à‡∏π‡∏î-‡∏•‡∏≠‡∏á‡∏à‡∏¥‡∏à‡∏π‡∏î** ‡∏Ç‡∏≠‡∏á 2 ‡∏à‡∏∏‡∏î (‡πÄ‡∏ä‡πà‡∏ô ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ ‡∏Å‡∏±‡∏ö ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏£‡∏ñ)
- ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á‡πÅ‡∏ö‡∏ö "‡∏•‡∏≤‡∏Å‡πÄ‡∏™‡πâ‡∏ô‡∏ï‡∏£‡∏á" ‡∏ú‡πà‡∏≤‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡πÇ‡∏•‡∏Å‡∏ó‡∏µ‡πà‡πÇ‡∏Ñ‡πâ‡∏á
- ‡πÑ‡∏î‡πâ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡πÄ‡∏õ‡πá‡∏ô **‡πÄ‡∏°‡∏ï‡∏£**
- **‡∏Ç‡πâ‡∏≠‡∏à‡∏≥‡∏Å‡∏±‡∏î:** ‡∏°‡∏±‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏∞‡∏¢‡∏∞ "‡πÄ‡∏™‡πâ‡∏ô‡∏ï‡∏£‡∏á" ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏£‡∏∞‡∏¢‡∏∞‡∏ï‡∏≤‡∏°‡∏ñ‡∏ô‡∏ô‡∏à‡∏£‡∏¥‡∏á

#### ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà 2: ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å API ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á "‡∏ï‡∏≤‡∏°‡∏ñ‡∏ô‡∏ô‡∏à‡∏£‡∏¥‡∏á"

> üìÅ ‡πÑ‡∏ü‡∏•‡πå: [route_service.dart](file:///z:/daft_ani-main/lib/services/route_service.dart#L18-L57)
> üìç ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ó‡∏µ‡πà **18‚Äì57** (‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô `getRoadDistance`)

**‡∏û‡∏π‡∏î‡∏á‡πà‡∏≤‡∏¢‡πÜ:** ‡πÄ‡∏£‡∏≤‡∏™‡πà‡∏á‡∏û‡∏¥‡∏Å‡∏±‡∏î 2 ‡∏à‡∏∏‡∏î‡πÑ‡∏õ‡πÉ‡∏´‡πâ **OpenRouteService API** ‡πÅ‡∏•‡πâ‡∏ß‡∏°‡∏±‡∏ô‡∏à‡∏∞‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á "‡∏ï‡∏≤‡∏°‡∏ñ‡∏ô‡∏ô‡∏à‡∏£‡∏¥‡∏á" ‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏°‡∏ï‡∏£ ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô Google Maps ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡πÉ‡∏´‡πâ

> üìç Fallback ‡∏≠‡∏¢‡∏π‡πà‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î **229‚Äì235** ‡πÉ‡∏ô `global_location_service.dart`

**Fallback (‡πÅ‡∏ú‡∏ô‡∏™‡∏≥‡∏£‡∏≠‡∏á):** ‡∏ñ‡πâ‡∏≤ API ‡∏•‡πà‡∏°‡∏´‡∏£‡∏∑‡∏≠‡∏ï‡∏≠‡∏ö‡∏ä‡πâ‡∏≤ (‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î **233‚Äì235**) ‚Üí ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡πÉ‡∏ä‡πâ Haversine (‡πÄ‡∏™‡πâ‡∏ô‡∏ï‡∏£‡∏á) ‡πÅ‡∏ó‡∏ô‡πÄ‡∏•‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö ‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡πÅ‡∏≠‡∏õ‡∏Ñ‡πâ‡∏≤‡∏á

---

### 3. ‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÅ‡∏ö‡∏ö 4 ‡∏Ç‡∏±‡πâ‡∏ô (Alert Stage)

> üìÅ ‡πÑ‡∏ü‡∏•‡πå: [global_location_service.dart](file:///z:/daft_ani-main/lib/services/global_location_service.dart#L321-L359)
> üìç ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ó‡∏µ‡πà **321‚Äì359** (‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô `_updateClosestBus`)

**‡∏û‡∏π‡∏î‡∏á‡πà‡∏≤‡∏¢‡πÜ:** ‡∏û‡∏≠‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì ETA ‡πÑ‡∏î‡πâ‡πÅ‡∏•‡πâ‡∏ß (‡∏à‡∏≤‡∏Å‡∏™‡∏π‡∏ï‡∏£‡∏Ç‡πâ‡∏≠ 1) ‡πÄ‡∏£‡∏≤‡∏Å‡πá‡πÄ‡∏≠‡∏≤‡∏°‡∏≤‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏ß‡πà‡∏≤ "‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡πÑ‡∏´‡∏ô" ‡∏ñ‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏Å‡πá‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö ‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏ö‡∏ö **‡∏Ç‡∏±‡πâ‡∏ô‡∏ö‡∏±‡∏ô‡πÑ‡∏î** ‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ:

| ‡∏Ç‡∏±‡πâ‡∏ô | ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç | ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ß‡πà‡∏≤ | üìç ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î |
|------|----------|-------------|-----------|
| 1 | ETA ‚â§ 5 ‡∏ô‡∏≤‡∏ó‡∏µ (300 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ) | "‡∏≠‡∏µ‡∏Å 5 ‡∏ô‡∏≤‡∏ó‡∏µ‡∏à‡∏∞‡∏ñ‡∏∂‡∏á" | **353‚Äì358** |
| 2 | ETA ‚â§ 3 ‡∏ô‡∏≤‡∏ó‡∏µ (180 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ) | "‡∏≠‡∏µ‡∏Å 3 ‡∏ô‡∏≤‡∏ó‡∏µ‡∏à‡∏∞‡∏ñ‡∏∂‡∏á" | **346‚Äì351** |
| 3 | ETA ‚â§ 1 ‡∏ô‡∏≤‡∏ó‡∏µ (60 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ) | "‡∏≠‡∏µ‡∏Å 1 ‡∏ô‡∏≤‡∏ó‡∏µ‡∏à‡∏∞‡∏ñ‡∏∂‡∏á" | **339‚Äì344** |
| 4 | ‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á ‚â§ 250 ‡πÄ‡∏°‡∏ï‡∏£ | "‡∏£‡∏ñ‡πÉ‡∏Å‡∏•‡πâ‡∏°‡∏≤‡∏ñ‡∏∂‡∏á‡πÅ‡∏•‡πâ‡∏ß!" | **327‚Äì337** |

**‡∏à‡∏∏‡∏î‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç (‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 325):** ‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Ç‡∏±‡πâ‡∏ô‡∏à‡∏∞ **‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÅ‡∏Ñ‡πà‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏ï‡πà‡∏≠‡∏Ñ‡∏±‡∏ô** ‡∏Ñ‡∏£‡∏±‡∏ö ‡πÑ‡∏°‡πà‡∏á‡∏±‡πâ‡∏ô‡∏°‡∏±‡∏ô‡∏à‡∏∞ spam ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ ‚Äî ‡∏£‡∏∞‡∏ö‡∏ö‡πÉ‡∏ä‡πâ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ `_lastAlertStage` ‡∏à‡∏≥‡πÑ‡∏ß‡πâ‡∏ß‡πà‡∏≤‡∏Ñ‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÅ‡∏à‡πâ‡∏á‡∏ñ‡∏∂‡∏á‡∏Ç‡∏±‡πâ‡∏ô‡πÑ‡∏´‡∏ô‡πÅ‡∏•‡πâ‡∏ß ‡∏ñ‡πâ‡∏≤‡πÅ‡∏à‡πâ‡∏á‡∏Ç‡∏±‡πâ‡∏ô 2 ‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß ‡∏à‡∏∞‡πÑ‡∏°‡πà‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πâ‡∏≥ ‡∏à‡∏∞‡∏Ç‡πâ‡∏≤‡∏°‡πÑ‡∏õ‡πÅ‡∏à‡πâ‡∏á‡∏Ç‡∏±‡πâ‡∏ô 3 ‡πÄ‡∏•‡∏¢

---

### 4. ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏£‡∏ñ‡∏ß‡∏¥‡πà‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏´‡∏≤‡πÄ‡∏£‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡∏ß‡∏¥‡πà‡∏á‡∏´‡∏ô‡∏µ (Direction Detection)

> üìÅ ‡πÑ‡∏ü‡∏•‡πå: [global_location_service.dart](file:///z:/daft_ani-main/lib/services/global_location_service.dart#L263-L307)
> üìç ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ó‡∏µ‡πà **263‚Äì307** (‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô `_updateClosestBus`)

**‡∏û‡∏π‡∏î‡∏á‡πà‡∏≤‡∏¢‡πÜ:** ‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏∏‡∏î‡∏´‡∏°‡∏≤‡∏¢ ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡πÑ‡∏°‡πà‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏£‡∏ñ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏±‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö ‡∏°‡∏±‡∏ô‡∏à‡∏∞ **‡πÄ‡∏ä‡πá‡∏Ñ‡∏Å‡πà‡∏≠‡∏ô‡∏ß‡πà‡∏≤‡∏£‡∏ñ‡∏ß‡∏¥‡πà‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏´‡∏≤‡∏à‡∏∏‡∏î‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏£‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡∏ß‡∏¥‡πà‡∏á‡∏≠‡∏≠‡∏Å** ‡∏î‡πâ‡∏ß‡∏¢‡∏ß‡∏¥‡∏ò‡∏µ‡∏á‡πà‡∏≤‡∏¢‡πÜ ‡∏Ñ‡∏∑‡∏≠:

- ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î **270‚Äì274**: ‡∏ß‡∏±‡∏î‡∏£‡∏∞‡∏¢‡∏∞‡∏à‡∏≤‡∏Å **‡∏£‡∏ñ‡∏ñ‡∏∂‡∏á‡∏à‡∏∏‡∏î‡∏´‡∏°‡∏≤‡∏¢** (‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏ñ‡∏∂‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏£‡∏≤)
- ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î **276‚Äì277**: ‡∏î‡∏∂‡∏á **‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏¢‡∏∞‡∏£‡∏≠‡∏ö‡∏Å‡πà‡∏≠‡∏ô** ‡∏°‡∏≤‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö
- ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î **280**: ‡∏ñ‡πâ‡∏≤‡∏£‡∏∞‡∏¢‡∏∞ **‡∏•‡∏î‡∏•‡∏á** ‡∏´‡∏£‡∏∑‡∏≠ **‡πÄ‡∏ó‡πà‡∏≤‡πÄ‡∏î‡∏¥‡∏°** ‚Üí ‡∏£‡∏ñ‡∏Å‡∏≥‡∏•‡∏±‡∏á **‡∏ß‡∏¥‡πà‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏´‡∏≤** ‡∏à‡∏∏‡∏î‡∏´‡∏°‡∏≤‡∏¢ ‚úÖ
- ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î **287**: ‡∏ñ‡πâ‡∏≤‡∏£‡∏∞‡∏¢‡∏∞ **‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡∏∂‡πâ‡∏ô** ‚Üí ‡∏£‡∏ñ **‡∏ß‡∏¥‡πà‡∏á‡∏´‡∏ô‡∏µ** ‡∏à‡∏∏‡∏î‡∏´‡∏°‡∏≤‡∏¢ ‚ùå ‚Üí ‡∏Ç‡πâ‡∏≤‡∏°‡πÑ‡∏õ
- ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î **306**: ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ß‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏≠‡∏ö‡∏´‡∏ô‡πâ‡∏≤

‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏£‡∏≤‡∏î‡∏π‡∏ß‡πà‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤‡∏´‡∏≤ ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏î‡∏¥‡∏ô‡∏≠‡∏≠‡∏Å‡πÑ‡∏õ ‡∏Å‡πá‡∏î‡∏π‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏¢‡∏∞‡∏ß‡πà‡∏≤‡∏°‡∏±‡∏ô‡πÉ‡∏Å‡∏•‡πâ‡∏Ç‡∏∂‡πâ‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏Å‡∏•‡∏Ç‡∏∂‡πâ‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö

---

### 5. ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á (Weighted Score)

> üìÅ ‡πÑ‡∏ü‡∏•‡πå: [route_planner_service.dart](file:///z:/daft_ani-main/lib/services/route_planner_service.dart#L182-L198)
> üìç ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ó‡∏µ‡πà **182‚Äì198** (‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô `_calculateWeightedScore`)

**‡∏û‡∏π‡∏î‡∏á‡πà‡∏≤‡∏¢‡πÜ:** ‡∏£‡∏∞‡∏ö‡∏ö‡∏´‡∏≤‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡πÑ‡∏î‡πâ‡∏´‡∏•‡∏≤‡∏¢‡πÄ‡∏™‡πâ‡∏ô ‡πÅ‡∏•‡πâ‡∏ß‡∏à‡∏∞‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÄ‡∏™‡πâ‡∏ô‡πÑ‡∏´‡∏ô? ‡∏Å‡πá‡πÉ‡∏ä‡πâ **‡∏£‡∏∞‡∏ö‡∏ö‡πÉ‡∏´‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô** ‡∏Ñ‡∏£‡∏±‡∏ö ‡∏¢‡∏¥‡πà‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô **‡∏ô‡πâ‡∏≠‡∏¢** ‡∏¢‡∏¥‡πà‡∏á **‡∏î‡∏µ**

‡∏™‡∏π‡∏ï‡∏£: **‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô = ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏õ‡πâ‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ô‡∏±‡πà‡∏á + ‡∏Ñ‡πà‡∏≤‡∏õ‡∏£‡∏±‡∏ö**

‡∏Ñ‡πà‡∏≤‡∏õ‡∏£‡∏±‡∏ö‡∏°‡∏µ 2 ‡∏ï‡∏±‡∏ß:
- **‡∏Ñ‡πà‡∏≤‡∏õ‡∏£‡∏±‡∏ö‡∏ß‡∏ô‡∏£‡∏ñ** (‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î **186‚Äì188**): ‡∏ñ‡πâ‡∏≤‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡∏ï‡πâ‡∏≠‡∏á‡∏ô‡∏±‡πà‡∏á‡∏ß‡∏ô‡∏£‡∏≠‡∏ö ‚Üí ‡πÇ‡∏î‡∏ô **+20** ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏•‡∏¢ (‡∏´‡∏ô‡∏±‡∏Å‡∏°‡∏≤‡∏Å ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡πÄ‡∏™‡∏µ‡∏¢‡πÄ‡∏ß‡∏•‡∏≤)
- **‡∏Ñ‡πà‡∏≤‡∏õ‡∏£‡∏±‡∏ö‡∏ï‡πà‡∏≠‡∏£‡∏ñ** (‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î **192‚Äì194**): ‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏≤‡∏¢ ‚Üí ‡πÇ‡∏î‡∏ô **+5** ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ï‡πà‡∏≠‡∏Ñ‡∏£‡∏±‡πâ‡∏á (‡∏û‡∏≠‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏≠‡∏£‡∏ñ‡πÉ‡∏´‡∏°‡πà)
- **‡∏£‡∏ß‡∏°‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô** (‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î **196‚Äì197**): ‡∏ô‡∏±‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏õ‡πâ‡∏≤‡∏¢‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î + penalty = ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏ß‡∏°

**‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á:**
- **‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á A:** ‡∏ô‡∏±‡πà‡∏á S1 ‡∏ï‡∏£‡∏á‡πÑ‡∏õ 8 ‡∏õ‡πâ‡∏≤‡∏¢ ‚Üí ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô = 8 + 0 + 0 = **8** ‚úÖ ‡∏î‡∏µ‡∏™‡∏∏‡∏î
- **‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á B:** ‡∏ô‡∏±‡πà‡∏á S1 ‡∏ï‡πà‡∏≠ S2 ‡∏£‡∏ß‡∏° 5 ‡∏õ‡πâ‡∏≤‡∏¢ ‡πÅ‡∏ï‡πà‡∏ï‡πà‡∏≠‡∏£‡∏ñ 1 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á ‚Üí ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô = 5 + 0 + 5 = **10**
- **‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á C:** ‡∏ô‡∏±‡πà‡∏á S1 ‡∏ß‡∏ô‡∏•‡∏π‡∏õ 6 ‡∏õ‡πâ‡∏≤‡∏¢ ‚Üí ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô = 6 + 20 + 0 = **26** ‚ùå ‡πÅ‡∏¢‡πà‡∏™‡∏∏‡∏î

‚Üí ‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏à‡∏≤‡∏Å‡∏ô‡πâ‡∏≠‡∏¢‡πÑ‡∏õ‡∏°‡∏≤‡∏Å ‡πÅ‡∏•‡πâ‡∏ß‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥ **‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á A** ‡∏Å‡πà‡∏≠‡∏ô

---

### 6. ‡∏ô‡∏±‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏õ‡πâ‡∏≤‡∏¢‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏ó‡∏≤‡∏á (Linear vs Circular)

> üìÅ ‡πÑ‡∏ü‡∏•‡πå: [route_planner_service.dart](file:///z:/daft_ani-main/lib/services/route_planner_service.dart#L266-L278)
> üìç ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ó‡∏µ‡πà **266‚Äì278** (‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô `_calculateStopCount`)

**‡∏û‡∏π‡∏î‡∏á‡πà‡∏≤‡∏¢‡πÜ:** ‡πÄ‡∏ß‡∏•‡∏≤‡∏ô‡∏±‡∏ö‡∏ß‡πà‡∏≤ "‡∏à‡∏≤‡∏Å‡∏õ‡πâ‡∏≤‡∏¢ A ‡∏ñ‡∏∂‡∏á‡∏õ‡πâ‡∏≤‡∏¢ B ‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏µ‡πà‡∏õ‡πâ‡∏≤‡∏¢" ‡∏°‡∏µ 2 ‡∏Å‡∏£‡∏ì‡∏µ‡∏Ñ‡∏£‡∏±‡∏ö:

**‡∏Å‡∏£‡∏ì‡∏µ‡∏ó‡∏µ‡πà 1 ‚Äî ‡πÑ‡∏õ‡∏ó‡∏≤‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß (‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 272‚Äì273):** ‡∏ñ‡πâ‡∏≤‡∏õ‡πâ‡∏≤‡∏¢ A ‡∏≠‡∏¢‡∏π‡πà‡∏Å‡πà‡∏≠‡∏ô B ‡πÉ‡∏ô‡∏•‡∏≥‡∏î‡∏±‡∏ö ‡∏Å‡πá‡πÅ‡∏Ñ‡πà **‡πÄ‡∏≠‡∏≤‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á B ‡∏•‡∏ö A**
- ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: A ‡∏≠‡∏¢‡∏π‡πà‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ó‡∏µ‡πà 2, B ‡∏≠‡∏¢‡∏π‡πà‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ó‡∏µ‡πà 5 ‚Üí 5 - 2 = **3 ‡∏õ‡πâ‡∏≤‡∏¢**

**‡∏Å‡∏£‡∏ì‡∏µ‡∏ó‡∏µ‡πà 2 ‚Äî ‡∏ß‡∏ô‡∏•‡∏π‡∏õ (‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 274‚Äì276):** ‡∏ñ‡πâ‡∏≤ A ‡∏≠‡∏¢‡∏π‡πà **‡∏´‡∏•‡∏±‡∏á** B ‡πÉ‡∏ô‡∏•‡∏≥‡∏î‡∏±‡∏ö ‡πÅ‡∏ï‡πà‡∏™‡∏≤‡∏¢‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏ß‡∏á‡∏Å‡∏•‡∏° ‡∏Å‡πá‡∏ï‡πâ‡∏≠‡∏á "‡∏ô‡∏±‡πà‡∏á‡∏ß‡∏ô‡∏Ç‡πâ‡∏≤‡∏°‡∏à‡∏∏‡∏î‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô"
- ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ô‡∏±‡∏ö: ‡∏ô‡∏±‡∏ö‡∏à‡∏≤‡∏Å A ‡πÑ‡∏õ‡∏à‡∏ô‡∏™‡∏∏‡∏î‡∏™‡∏≤‡∏¢ ‡πÅ‡∏•‡πâ‡∏ß‡∏ö‡∏ß‡∏Å‡∏à‡∏≤‡∏Å‡∏à‡∏∏‡∏î‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏°‡∏≤‡∏ñ‡∏∂‡∏á B
- ‡∏™‡∏π‡∏ï‡∏£: **(‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏õ‡πâ‡∏≤‡∏¢‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î - 1 - ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á A) + ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á B**
- ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: ‡∏™‡∏≤‡∏¢ S2 ‡∏°‡∏µ 13 ‡∏õ‡πâ‡∏≤‡∏¢, A ‡∏≠‡∏¢‡∏π‡πà‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á 10, B ‡∏≠‡∏¢‡∏π‡πà‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á 3 ‚Üí (12 - 10) + 3 = **5 ‡∏õ‡πâ‡∏≤‡∏¢**

---

### 7. ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏™‡∏≤‡∏¢‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏ß‡∏á‡∏Å‡∏•‡∏°‡πÑ‡∏´‡∏° (Circular Route)

> üìÅ ‡πÑ‡∏ü‡∏•‡πå: [route_planner_service.dart](file:///z:/daft_ani-main/lib/services/route_planner_service.dart#L260-L263)
> üìç ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ó‡∏µ‡πà **260‚Äì263** (‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô `_isCircular`)

**‡∏û‡∏π‡∏î‡∏á‡πà‡∏≤‡∏¢‡πÜ:** ‡∏î‡∏π‡∏á‡πà‡∏≤‡∏¢‡∏°‡∏≤‡∏Å‡∏Ñ‡∏£‡∏±‡∏ö ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î **262** ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤ **‡∏õ‡πâ‡∏≤‡∏¢‡πÅ‡∏£‡∏Å‡∏Å‡∏±‡∏ö‡∏õ‡πâ‡∏≤‡∏¢‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢‡πÄ‡∏õ‡πá‡∏ô‡∏õ‡πâ‡∏≤‡∏¢‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô‡πÑ‡∏´‡∏°** ‚Üí ‡∏ñ‡πâ‡∏≤‡πÉ‡∏ä‡πà‡∏Å‡πá‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡∏ß‡∏á‡∏Å‡∏•‡∏°
- **S2:** ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏µ‡πà PKY ‚Üí ‡∏ß‡∏ô‡πÑ‡∏õ ‚Üí ‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤ PKY ‚Üí ‚úÖ ‡πÄ‡∏õ‡πá‡∏ô‡∏ß‡∏á‡∏Å‡∏•‡∏°
- **S1-AM:** ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏µ‡πà‡∏´‡∏ô‡πâ‡∏≤‡∏°‡∏≠ ‚Üí ‡∏ß‡∏ô‡πÑ‡∏õ ‚Üí ‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏°‡∏≠ ‚Üí ‚úÖ ‡πÄ‡∏õ‡πá‡∏ô‡∏ß‡∏á‡∏Å‡∏•‡∏°

---

### 8. ‡∏£‡∏∞‡∏ö‡∏ö Cache (‡∏à‡∏≥‡∏Ñ‡πà‡∏≤‡πÄ‡∏Å‡πà‡∏≤‡πÑ‡∏ß‡πâ ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏Å API ‡∏ã‡πâ‡∏≥)

> üìÅ ‡πÑ‡∏ü‡∏•‡πå: [route_service.dart](file:///z:/daft_ani-main/lib/services/route_service.dart#L12-L28)
> üìç ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ó‡∏µ‡πà **13** (‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏® cache map), **14** (‡∏Å‡∏≥‡∏´‡∏ô‡∏î TTL 30 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ), **23‚Äì28** (‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤ cache ‡∏¢‡∏±‡∏á‡∏°‡∏µ‡∏≠‡∏≤‡∏¢‡∏∏‡πÑ‡∏´‡∏°)

**‡∏û‡∏π‡∏î‡∏á‡πà‡∏≤‡∏¢‡πÜ:** ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á‡∏à‡∏≤‡∏Å API ‡∏à‡∏∞ **‡∏à‡∏≥‡∏ú‡∏•‡πÑ‡∏ß‡πâ 30 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ** ‡∏Ñ‡∏£‡∏±‡∏ö (‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î **14**) ‡∏ñ‡πâ‡∏≤‡∏ñ‡∏≤‡∏°‡∏ã‡πâ‡∏≥‡∏†‡∏≤‡∏¢‡πÉ‡∏ô 30 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ ‚Üí ‡πÄ‡∏≠‡∏≤‡∏Ñ‡πà‡∏≤‡πÄ‡∏Å‡πà‡∏≤‡∏ï‡∏≠‡∏ö‡πÄ‡∏•‡∏¢ (‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î **26**) ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏Å API ‡πÉ‡∏´‡∏°‡πà ‡∏ä‡πà‡∏ß‡∏¢ **‡∏õ‡∏£‡∏∞‡∏´‡∏¢‡∏±‡∏î‡∏à‡∏≥‡∏ô‡∏ß‡∏ô API call** ‡πÅ‡∏•‡∏∞‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÅ‡∏≠‡∏õ **‡πÄ‡∏£‡πá‡∏ß‡∏Ç‡∏∂‡πâ‡∏ô**

‡∏ß‡∏¥‡∏ò‡∏µ‡πÄ‡∏ä‡πá‡∏Ñ (‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î **25**): ‡πÄ‡∏≠‡∏≤ **‡πÄ‡∏ß‡∏•‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô ‡∏•‡∏ö ‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà cache ‡πÑ‡∏ß‡πâ** ‡∏ñ‡πâ‡∏≤‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤ 30 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ ‚Üí ‡πÉ‡∏ä‡πâ‡∏Ñ‡πà‡∏≤‡πÄ‡∏Å‡πà‡∏≤‡πÑ‡∏î‡πâ ‡∏ñ‡πâ‡∏≤‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ ‚Üí ‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏ ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏Å API ‡πÉ‡∏´‡∏°‡πà

---

### 9. ‡πÄ‡∏ä‡πá‡∏Ñ‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏´‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏£‡∏ñ (Operating Hours)

> üìÅ ‡πÑ‡∏ü‡∏•‡πå: [bus_route_data.dart](file:///z:/daft_ani-main/lib/models/bus_route_data.dart#L43-L55)
> üìç ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ó‡∏µ‡πà **43‚Äì55** (‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô `isActiveAt`)

**‡∏û‡∏π‡∏î‡∏á‡πà‡∏≤‡∏¢‡πÜ:** ‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏™‡∏≤‡∏¢‡∏°‡∏µ‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏´‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡πÑ‡∏°‡πà‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Å‡∏±‡∏ô ‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤ "‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡∏™‡∏≤‡∏¢‡∏ô‡∏µ‡πâ‡∏ß‡∏¥‡πà‡∏á‡∏≠‡∏¢‡∏π‡πà‡πÑ‡∏´‡∏°"

- **‡∏Å‡∏£‡∏ì‡∏µ‡∏õ‡∏Å‡∏ï‡∏¥** (‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î **47‚Äì48**): ‡πÄ‡∏ä‡πà‡∏ô S1-AM 05:00‚Äì14:00 ‡∏î‡∏π‡∏á‡πà‡∏≤‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏ï‡πâ‡∏≠‡∏á **‡∏≠‡∏¢‡∏π‡πà‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á 5 ‡∏ñ‡∏∂‡∏á 14**
- **‡∏Å‡∏£‡∏ì‡∏µ‡∏Ç‡πâ‡∏≤‡∏°‡∏ß‡∏±‡∏ô** (‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î **49‚Äì51**): ‡πÄ‡∏ä‡πà‡∏ô S1-PM 14:00‚Äì00:00 ‡∏ï‡πâ‡∏≠‡∏á‡∏Ñ‡∏¥‡∏î‡∏ï‡πà‡∏≤‡∏á‡∏ô‡∏¥‡∏î‡∏ô‡∏∂‡∏á ‡∏Ñ‡∏∑‡∏≠‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏ï‡πâ‡∏≠‡∏á **‚â• 14 ‡∏´‡∏£‡∏∑‡∏≠ < 0** (‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏á‡∏Ñ‡∏∑‡∏ô)
- **‡∏Å‡∏£‡∏ì‡∏µ‡∏ß‡∏¥‡πà‡∏á‡∏ï‡∏•‡∏≠‡∏î** (‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î **44**): ‡∏ñ‡πâ‡∏≤ startHour ‡∏Å‡∏±‡∏ö endHour ‡πÄ‡∏õ‡πá‡∏ô null ‚Üí return true ‡πÄ‡∏•‡∏¢ (‡πÄ‡∏ä‡πà‡∏ô S2, S3)

| ‡∏™‡∏≤‡∏¢ | ‡πÄ‡∏£‡∏¥‡πà‡∏° | ‡∏à‡∏ö | ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏ |
|-----|-------|-----|----------|
| S1-AM | 05:00 | 14:00 | ‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô PKY |
| S1-PM | 14:00 | 00:00 | ‡∏ú‡πà‡∏≤‡∏ô PKY (‡∏Ç‡πâ‡∏≤‡∏°‡∏ß‡∏±‡∏ô) |
| S2 | ‚Äî | ‚Äî | ‡∏ß‡∏¥‡πà‡∏á‡∏ï‡∏•‡∏≠‡∏î‡∏ß‡∏±‡∏ô |
| S3 | ‚Äî | ‚Äî | ‡∏ß‡∏¥‡πà‡∏á‡∏ï‡∏•‡∏≠‡∏î‡∏ß‡∏±‡∏ô |

---

### 10. ‡∏´‡∏≤‡∏à‡∏∏‡∏î‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏≤‡∏¢ (Set Intersection)

> üìÅ ‡πÑ‡∏ü‡∏•‡πå: [route_planner_service.dart](file:///z:/daft_ani-main/lib/services/route_planner_service.dart#L574-L581)
> üìç ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ó‡∏µ‡πà **574‚Äì581** (‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô `_findTransferPoints`)

**‡∏û‡∏π‡∏î‡∏á‡πà‡∏≤‡∏¢‡πÜ:** ‡πÄ‡∏ß‡∏•‡∏≤‡∏à‡∏∞‡∏ï‡πà‡∏≠‡∏£‡∏ñ ‡∏ï‡πâ‡∏≠‡∏á‡∏´‡∏≤‡∏ß‡πà‡∏≤ "‡∏õ‡πâ‡∏≤‡∏¢‡πÑ‡∏´‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏™‡∏≤‡∏¢‡∏ó‡∏±‡πâ‡∏á 2 ‡∏™‡∏≤‡∏¢" ‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏Ñ‡∏∑‡∏≠:
- ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î **578**: ‡πÄ‡∏≠‡∏≤‡∏õ‡πâ‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡∏™‡∏≤‡∏¢ 1 ‡∏°‡∏≤‡∏ó‡∏≥‡πÄ‡∏õ‡πá‡∏ô Set
- ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î **579**: ‡πÄ‡∏≠‡∏≤‡∏õ‡πâ‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡∏™‡∏≤‡∏¢ 2 ‡∏°‡∏≤‡∏ó‡∏≥‡πÄ‡∏õ‡πá‡∏ô Set
- ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î **580**: ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å `.intersection()` ‡∏´‡∏≤‡∏ï‡∏±‡∏ß‡∏ó‡∏µ‡πà **‡∏ã‡πâ‡∏≥‡∏Å‡∏±‡∏ô** ‚Äî ‡∏ó‡∏≤‡∏á‡∏Ñ‡∏ì‡∏¥‡∏ï‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ß‡πà‡∏≤ **‡∏≠‡∏¥‡∏ô‡πÄ‡∏ï‡∏≠‡∏£‡πå‡πÄ‡∏ã‡∏Å‡∏ä‡∏±‡∏ô** ‡∏Ç‡∏≠‡∏á 2 ‡πÄ‡∏ã‡∏ï‡∏Ñ‡∏£‡∏±‡∏ö

**‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á:**
- ‡∏™‡∏≤‡∏¢ S1-AM ‡∏ú‡πà‡∏≤‡∏ô: ‡∏´‡∏ô‡πâ‡∏≤‡∏°‡∏≠, ‡∏ß‡∏¥‡∏®‡∏ß‡∏∞, ‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°, ‡∏≠‡∏ò‡∏¥‡∏Å‡∏≤‡∏£, ‡∏®‡∏¥‡∏•‡∏õ‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå, ‡∏Ñ‡∏ì‡∏∞‡∏ß‡∏¥‡∏ó‡∏¢‡πå
- ‡∏™‡∏≤‡∏¢ S2 ‡∏ú‡πà‡∏≤‡∏ô: PKY, UB99, ‡πÄ‡∏ß‡∏µ‡∏¢‡∏á, ‡∏™‡∏á‡∏ß‡∏ô, ‡∏™‡∏≤‡∏ò‡∏¥‡∏ï, ‡∏®‡∏¥‡∏•‡∏õ‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå, ‡∏Ñ‡∏ì‡∏∞‡∏ß‡∏¥‡∏ó‡∏¢‡πå, ‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°, ‡∏≠‡∏ò‡∏¥‡∏Å‡∏≤‡∏£
- **‡∏õ‡πâ‡∏≤‡∏¢‡∏ã‡πâ‡∏≥‡∏Å‡∏±‡∏ô** = {‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°, ‡∏≠‡∏ò‡∏¥‡∏Å‡∏≤‡∏£, ‡∏®‡∏¥‡∏•‡∏õ‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå, ‡∏Ñ‡∏ì‡∏∞‡∏ß‡∏¥‡∏ó‡∏¢‡πå} ‚Üí ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏≤‡∏¢‡πÑ‡∏î‡πâ **4 ‡∏à‡∏∏‡∏î**

---

## ‡∏™‡∏£‡∏∏‡∏õ Flow ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏´‡∏•‡∏±‡∏Å

```mermaid
graph TD
    A["main.dart<br/>Firebase.initializeApp()"] --> B["GlobalLocationService<br/>(Provider)"]
    A --> C["MyApp ‚Üí Routes"]
    C --> D["UpBusHomePage<br/>‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å ‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà Live"]
    C --> E["BusStopPage<br/>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏õ‡πâ‡∏≤‡∏¢‡∏£‡∏ñ"]
    C --> F["RoutePage<br/>‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á"]
    C --> G["PlanPage<br/>‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á"]
    C --> H["FeedbackPage<br/>‡∏™‡πà‡∏á Feedback"]
    C --> I["LoginPage<br/>‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô"]
    
    D -->|"‡∏î‡∏∂‡∏á GPS ‡∏£‡∏ñ"| J["Realtime Database<br/>path: GPS/"]
    D -->|"‡∏î‡∏∂‡∏á‡∏õ‡πâ‡∏≤‡∏¢"| K["Firestore<br/>collection: busstop"]
    D -->|"GeoJSON"| L["assets/data/"]
    
    B -->|"‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á"| M["Geolocator"]
    B -->|"‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô"| N["NotificationService"]
    
    G -->|"‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á"| O["RoutePlannerService"]
    O -->|"‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡πâ‡∏≤‡∏¢"| P["bus_route_data.dart"]
    
    I -->|"Driver"| Q["ChangeRoutePage"]
    I -->|"Manager"| R["ManagerPage"]
    
    Q -->|"‡∏à‡∏≠‡∏á‡∏£‡∏ñ/‡∏õ‡∏•‡πà‡∏≠‡∏¢‡∏£‡∏ñ"| J
    R -->|"‡∏î‡∏π Report"| K
    R -->|"‡∏î‡∏π‡∏Ñ‡∏ô‡∏Ç‡∏±‡∏ö"| J
```
